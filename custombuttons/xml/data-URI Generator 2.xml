<?xml version="1.0" encoding="UTF-8"?>
<custombutton xmlns:cb="http://xsms.nm.ru/custombuttons/"
              xmlns:html="http://www.w3.org/1999/xhtml">
  <html:head>
    <html:title><![CDATA[data:URI Generator]]></html:title>
    <html:link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAEG0lEQVR4AQEQBO/7Af///wAAAAAAAAAAAAAAAACIqt3/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHlXJE7///+zAAAAAAAAAAAA////AP///wD///8A////AIep3P/+/v7/////////////////+/3///H4//+Hqdz/k7vm/wAAAE3///8A////AAIAAAAAAAAAAAAAAACIqt3/ZEkdAAEBAQAAAAAAAAAAAPz+AAD2+wAA+Pv+AAAAAAC7+BkAbKjgsgEBAU0AAAAAAgAAAAAAAAAAAAAAAAAAAABEjzYA3OrcAAAAAAD8/gAA9vsAAPv9AADu8/sA/Pr/ACPj1wAA5vAAhJ+/sgEBAU0CAAAAAAAAAAAAAAAA+fPzAAwPAwBNnUMA9fr4APb7AAD7/QAA+f0AAAYIBwBQQSQAWEgpAEo2LwD76eQAAAAACwIAAAAAAAAAAIGd0P87NfkA+fz5ACY5CQA0jC8A+/0AAPn9AAD4/AAA+fwAAPoCAAD/BQAA8u/5AIF4XXQAAAC/BDqRNP86SRUA9DH0AKHx9QAjMQAA9P/+AP0g7QA/jy4AsmrSAPn8AAD3/AAA+/0AAPb8AADz7+kAAAAA5f///+kEAAAAABUWDQAICP8ABQb9APf3AADt8fYA/AP+APv89wD5/AAA9/wAAPv9AAD2/AAA+fMAAODjvgAAAAAAAAAAAATy9PoAo5XYAAAAAAAAAAAAAAAAABEz/QDx2v0Asl/FAPf8AAD7/QAA9vwAAPv9AAD15/gA4+PgAAAAAAAAAAAAAtV8005VGKIAv2vGAMFx0gAAAAAA780PAII/pAAJBxYA+/0AAPb8AAD7/QAA+fwAAPXs5gCimIF0AAAAvwAAAAAC////s/z5+QABBgsA+f0AAAAAAAA/JFIAOSVOAPv9AAD2/AAA+/0AAPn8AAD89wAA1tm8AAAAAOX////pAAAAAAIAAAAA/fr6APr9AQD4/AAALRk9AGM+gAD7/QAA9vwAAPv9AAD5/AAA9/wAAALw+ADm6OUAAAAAAAAAAAAAAAAAAm98r/9lWC0A+PwAAPn8AAB1SZUA+/0AAPb8AAD7/QAA+fwAAPf8AAD5/AAA+OviAPf48gAAAAAAAAAAAAAAAAAEAAAAAL/G6gD//eYA/v38AP79/QD+/f0A/f79AP/9/AD+/fwA/v38AP/9/QDl6d4ArKKQdAAAAL8AAAAAAAAAAAEAAABNAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADK////6QAAAAAAAAAAAf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABG02wnJgS1xwAAAABJRU5ErkJggg=="/>
    <html:style type="text/css"><![CDATA[body { font-size: medium; margin: 0; }
body, code:before, help:before, initcode:before {
  font-family: "Verdana", sans-serif;
}
#wrapper { position: fixed; top: 1em; right: 1em; text-align: center; }
p { font-size: small; text-align: center; }
#button {
  background-color: rgb(85, 168, 2);
  background-image: linear-gradient(to bottom, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -moz-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -o-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -webkit-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  border: 1px solid rgb(58, 116, 4);
  border-radius: .5em;
  -moz-border-radius: .5em;
  -webkit-border-radius: .5em;
  padding: 0;
  margin-bottom: 1em;
  box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -moz-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -o-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -webkit-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
}
#button a {
  color: #000;
  text-shadow: -1pt -1px 0pt rgba(255, 255, 255, .5);
  padding: 1em;
  text-decoration: none;
}
#button a, code, code:before, initcode, initcode:before, help, help:before {
  display: block;
}
#credits { position: fixed; bottom: 1em; right: 1em; font-size: small; }
custombutton { background-color: rgb(171, 171, 171); margin: 1em; }
date, image, mode, accelkey { display: none; }
name { font-weight: bold; font-size: x-large; }
code:before, help:before, initcode:before {
  font-weight: bold;
  font-size: large;
  margin: 0 0 1em;
  padding: .5em;
}
code:before { content: "CODE"; }
help:before { content: "Help"; }
initcode:before { content: "Initialization Code"; }
code, initcode, help {
  background-color: rgb(255, 255, 255);
  border: 1px inset rgb(170, 170, 170);
  font: medium monospace;
  margin: 1em 1em 2em 0;
  padding: 1em;
  text-align: left;
  width: 840px;
  white-space: pre-wrap;
  word-wrap: break-word;
}
.clear { clear: both; }
]]></html:style>
  </html:head>
  <html:body>
    <html:div id="wrapper">
      <html:div id="button">
        <html:a href="custombutton://%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0D%0A%3Ccustombutton%20xmlns%3Acb%3D%22http%3A//xsms.nm.ru/custombuttons/%22%3E%0A%20%20%3Cname%3Edata%3AURI%20Generator%3C/name%3E%0A%20%20%3Cimage%3E%3C%21%5BCDATA%5Bdata%3Aimage/png%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAEG0lEQVR4AQEQBO/7Af///wAAAAAAAAAAAAAAAACIqt3/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHlXJE7///+zAAAAAAAAAAAA////AP///wD///8A////AIep3P/+/v7/////////////////+/3///H4//+Hqdz/k7vm/wAAAE3///8A////AAIAAAAAAAAAAAAAAACIqt3/ZEkdAAEBAQAAAAAAAAAAAPz+AAD2+wAA+Pv+AAAAAAC7+BkAbKjgsgEBAU0AAAAAAgAAAAAAAAAAAAAAAAAAAABEjzYA3OrcAAAAAAD8/gAA9vsAAPv9AADu8/sA/Pr/ACPj1wAA5vAAhJ+/sgEBAU0CAAAAAAAAAAAAAAAA+fPzAAwPAwBNnUMA9fr4APb7AAD7/QAA+f0AAAYIBwBQQSQAWEgpAEo2LwD76eQAAAAACwIAAAAAAAAAAIGd0P87NfkA+fz5ACY5CQA0jC8A+/0AAPn9AAD4/AAA+fwAAPoCAAD/BQAA8u/5AIF4XXQAAAC/BDqRNP86SRUA9DH0AKHx9QAjMQAA9P/+AP0g7QA/jy4AsmrSAPn8AAD3/AAA+/0AAPb8AADz7+kAAAAA5f///+kEAAAAABUWDQAICP8ABQb9APf3AADt8fYA/AP+APv89wD5/AAA9/wAAPv9AAD2/AAA+fMAAODjvgAAAAAAAAAAAATy9PoAo5XYAAAAAAAAAAAAAAAAABEz/QDx2v0Asl/FAPf8AAD7/QAA9vwAAPv9AAD15/gA4+PgAAAAAAAAAAAAAtV8005VGKIAv2vGAMFx0gAAAAAA780PAII/pAAJBxYA+/0AAPb8AAD7/QAA+fwAAPXs5gCimIF0AAAAvwAAAAAC////s/z5+QABBgsA+f0AAAAAAAA/JFIAOSVOAPv9AAD2/AAA+/0AAPn8AAD89wAA1tm8AAAAAOX////pAAAAAAIAAAAA/fr6APr9AQD4/AAALRk9AGM+gAD7/QAA9vwAAPv9AAD5/AAA9/wAAALw+ADm6OUAAAAAAAAAAAAAAAAAAm98r/9lWC0A+PwAAPn8AAB1SZUA+/0AAPb8AAD7/QAA+fwAAPf8AAD5/AAA+OviAPf48gAAAAAAAAAAAAAAAAAEAAAAAL/G6gD//eYA/v38AP79/QD+/f0A/f79AP/9/AD+/fwA/v38AP/9/QDl6d4ArKKQdAAAAL8AAAAAAAAAAAEAAABNAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADK////6QAAAAAAAAAAAf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABG02wnJgS1xwAAAABJRU5ErkJggg%3D%3D%5D%5D%3E%3C/image%3E%0A%20%20%3Cmode%3E0%3C/mode%3E%0A%20%20%3Cinitcode%3E%3C%21%5BCDATA%5Bvar%20promptService%20%3D%20Components.classes%5B%22@mozilla.org/embedcomp/prompt-service%3B1%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.getService%28Components.interfaces.nsIPromptService%29%3B%0A%0Afunction%20selectItems%28aText%2C%20aItems%29%20%7B%0A%20%20var%20selected%20%3D%20%7B%7D%3B%0A%20%20var%20result%20%3D%20promptService.select%28null%2C%20%22data%3AURI%20Generator%22%2C%20aText%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20aItems.length%2C%20aItems%2C%20selected%29%3B%0A%20%20if%20%28result%29%20return%20selected.value%3B%0A%20%20return%3B%0A%7D%0A%0Afunction%20selectedText%28%29%20%7B%0A%20%20var%20focusedWindow%20%3D%20document.commandDispatcher.focusedWindow%3B%0A//var%20winWrapper%20%3D%20new%20XPCNativeWrapper%28focusedWindow%2C%20%22document%22%2C%20%22getSelection%28%29%22%29%3B%0A//var%20string%20%3D%20winWrapper.getSelection%28%29%3B%0A%20%20var%20string%20%3D%20focusedWindow.getSelection%28%29%3B%0A%20%20if%28string%20%3D%3D%20%22%22%29%20return%3B%0A%20%20return%20string%3B%0A%7D%0A%0Afunction%20getText%28%29%20%7B%0A%20%20var%20str%20%3D%20selectedText%28%29%20%7C%7C%20readFromClipboard%28%29%3B%0A%20%20return%20str%3B%0A%7D%0A%0Afunction%20getInput%28aText%2C%20aCheckText%2C%20aFlag%2C%20aCheck%29%20%7B%0A%20%20return%20promptService.confirmEx%28window%2C%20%22data%3AURI%22%2C%20aText%2C%20aFlag%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Button_0%22%2C%20%22Button_1%22%2C%20%22Button_2%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20aCheckText%2C%20aCheck%29%3B%0A%7D%0A%0Afunction%20getContentType%28%29%20%7B%0A%20%20var%20text%20%3D%20%22MIME%20type%22%3B%0A%0A%20%20var%20type%20%3D%20%5B%22Plain%20text%22%2C%20%22Web%20page%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22JavaScript%22%2C%20%22CSS%22%2C%20%22XML%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22XUL%22%2C%20%22Other%20...%22%5D%3B%0A%0A%20%20var%20mime%20%3D%20%5B%22text/plain%22%2C%20%22text/html%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22application/x-javascript%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22text/css%22%2C%20%22application/xml%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22application/vnd.mozilla.xul+xml%22%5D%3B%0A%0A%20%20var%20index%20%3D%20selectItems%28%22Select%20%22%20+%20text%2C%20type%29%3B%0A%20%20if%20%28index%20%21%3D%20undefined%29%20%7B%0A%20%20%20%20if%20%28%21mime%5Bindex%5D%29%20%7B%0A%20%20%20%20%20%20var%20ct%20%3D%20prompt%28%22Enter%20%22%20+%20text%20+%20%22%2C%20example%3A%20text/html%22%29%3B%0A%20%20%20%20%20%20if%20%28ct%29%20return%20ct%3B%0A%20%20%20%20%20%20return%3B%0A%20%20%20%20%7D%0A%20%20%20%20return%20mime%5Bindex%5D%3B%0A%20%20%7D%0A%7D%0A%0Afunction%20getCharacterSet%28%29%20%7B%0A%20%20var%20text%20%3D%20%22character%20set%22%3B%0A%20%20var%20charset%20%3D%20%5B%22%28default%29%22%2C%20%22iso-8859-1%22%2C%20%22utf-8%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22windows-1252%22%2C%20%22Other%20...%22%5D%3B%0A%0A%20%20var%20index%20%3D%20selectItems%28%22Select%20%22%20+%20text%2C%20charset%29%3B%0A%20%20if%20%28index%20%3D%3D%200%29%20return%20%22%22%3B%0A%20%20if%20%28index%20%21%3D%20undefined%29%20%7B%0A%20%20%20%20if%20%28index%20%3D%3D%20charset.length-1%29%20%7B%0A%20%20%20%20%20%20var%20cs%20%3D%20prompt%28%22Enter%20%22%20+%20text%20+%20%22%20or%20leave%20it%20blank%22%29%3B%0A%20%20%20%20%20%20return%20cs%3B%0A%20%20%20%20%7D%0A%20%20%20%20return%20charset%5Bindex%5D%3B%0A%20%20%7D%0A%7D%0A%0Athis.getDataURI%20%3D%20function%28%29%20%7B%0A%20%20if%28%21getText%28%29%29%20%7B%0A%20%20%20%20alert%28%22No%20text%20in%20clipboard%20or%20no%20text%20selected.%22%29%3B%0A%20%20%20%20return%3B%0A%20%20%7D%0A%0A%20%20var%20title%20%3D%20%22data%3AURI%22%3B%0A%20%20var%20prefix%20%3D%20%22data%3A%22%0A%0A%20%20var%20ctype%20%3D%20getContentType%28%29%3B%0A%20%20if%20%28%21ctype%29%20return%3B%0A%20%20prefix%20+%3D%20ctype%3B%0A%0A%20%20var%20charset%20%3D%20getCharacterSet%28%29%3B%0A%20%20if%20%28charset%20%3D%3D%20undefined%29%20return%3B%0A%20%20charset%20%3D%20charset%20%3D%3D%20%22%22%20%3F%20%22%22%20%3A%20%22%3Bcharset%3D%22%20+%20charset%3B%0A%20%20prefix%20+%3D%20charset%3B%0A%0A%20%20var%20checkBase64%20%3D%20%7Bvalue%3Afalse%7D%3B%0A%20%20var%20flagBase64%20%3D%200%3B%0A%0A//%20%20var%20doIt%20%3D%20getInput%28prefix%2C%20%22Base%2064%22%2C%20flagBase64%2C%20checkBase64%29%3B%0A//%20%20if%28doIt%29%20return%3B%0A%0A%20%20var%20base64%20%3D%20checkBase64.value%3B%0A%0A%20%20var%20encode%20%3D%20base64%20%3F%20encodeURIComponent%28btoa%28getText%28%29%29%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20encodeURIComponent%28getText%28%29%29%3B%0A%0A%20%20var%20dataURI%20%3D%20%22data%3A%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ctype%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20charset%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%28base64%20%3F%20%22%3Bbase64%2C%22%20%3A%20%22%2C%22%29%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20encode%3B%0A%0A%20%20var%20backgroundTab%20%3D%20gPrefService.getBoolPref%28%22browser.tabs.loadInBackground%22%29%3B%0A%20%20if%20%28content.location%20%3D%3D%20%22about%3Ablank%22%29%20%7B%0A%20%20%20%20loadURI%28dataURI%29%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20gBrowser.loadOneTab%28dataURI%2C%20null%2C%20null%2C%20null%2C%20false%29%3B%0A%20%20%7D%0A%0A%20%20//DTA_ContextOverlay.findLinks%28false%29%3B%0A%0A%7D%0A%0A/*%0Athis.setAttribute%28%22homepage%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22http%3A//custombuttons.phpbbnow.com/viewtopic.php%3Ft%3D68%23105%22%29%3B%0A*/%0A%5D%5D%3E%3C/initcode%3E%0A%20%20%3Ccode%3E%3C%21%5BCDATA%5Bthis.getDataURI%28%29%3B%5D%5D%3E%3C/code%3E%0A%20%20%3Caccelkey%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/accelkey%3E%0A%20%20%3Chelp%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/help%3E%0A%20%20%3Cattributes/%3E%0A%3C/custombutton%3E" rel="nofollow" title="Install data:URI Generator">
        <![CDATA[Install this button]]>
        </html:a>
      </html:div>
      <html:a href="https://addons.mozilla.org/addon/custom-buttons/?src=custom-buttons-xml">
        <![CDATA[What's this?]]>
      </html:a>
      <html:div id="credits">
        <html:a href="http://custombuttons.sourceforge.net/forum/viewtopic.php?t=78#p197">
          <![CDATA[Custom Buttons XML]]><html:br/><![CDATA[Exporter/Importer]]>
        </html:a>
      </html:div>
    </html:div>
  </html:body>
  <date id="date" value="20120329"/>
  <name>data:URI Generator</name>
  <image><![CDATA[data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAEG0lEQVR4AQEQBO/7Af///wAAAAAAAAAAAAAAAACIqt3/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHlXJE7///+zAAAAAAAAAAAA////AP///wD///8A////AIep3P/+/v7/////////////////+/3///H4//+Hqdz/k7vm/wAAAE3///8A////AAIAAAAAAAAAAAAAAACIqt3/ZEkdAAEBAQAAAAAAAAAAAPz+AAD2+wAA+Pv+AAAAAAC7+BkAbKjgsgEBAU0AAAAAAgAAAAAAAAAAAAAAAAAAAABEjzYA3OrcAAAAAAD8/gAA9vsAAPv9AADu8/sA/Pr/ACPj1wAA5vAAhJ+/sgEBAU0CAAAAAAAAAAAAAAAA+fPzAAwPAwBNnUMA9fr4APb7AAD7/QAA+f0AAAYIBwBQQSQAWEgpAEo2LwD76eQAAAAACwIAAAAAAAAAAIGd0P87NfkA+fz5ACY5CQA0jC8A+/0AAPn9AAD4/AAA+fwAAPoCAAD/BQAA8u/5AIF4XXQAAAC/BDqRNP86SRUA9DH0AKHx9QAjMQAA9P/+AP0g7QA/jy4AsmrSAPn8AAD3/AAA+/0AAPb8AADz7+kAAAAA5f///+kEAAAAABUWDQAICP8ABQb9APf3AADt8fYA/AP+APv89wD5/AAA9/wAAPv9AAD2/AAA+fMAAODjvgAAAAAAAAAAAATy9PoAo5XYAAAAAAAAAAAAAAAAABEz/QDx2v0Asl/FAPf8AAD7/QAA9vwAAPv9AAD15/gA4+PgAAAAAAAAAAAAAtV8005VGKIAv2vGAMFx0gAAAAAA780PAII/pAAJBxYA+/0AAPb8AAD7/QAA+fwAAPXs5gCimIF0AAAAvwAAAAAC////s/z5+QABBgsA+f0AAAAAAAA/JFIAOSVOAPv9AAD2/AAA+/0AAPn8AAD89wAA1tm8AAAAAOX////pAAAAAAIAAAAA/fr6APr9AQD4/AAALRk9AGM+gAD7/QAA9vwAAPv9AAD5/AAA9/wAAALw+ADm6OUAAAAAAAAAAAAAAAAAAm98r/9lWC0A+PwAAPn8AAB1SZUA+/0AAPb8AAD7/QAA+fwAAPf8AAD5/AAA+OviAPf48gAAAAAAAAAAAAAAAAAEAAAAAL/G6gD//eYA/v38AP79/QD+/f0A/f79AP/9/AD+/fwA/v38AP/9/QDl6d4ArKKQdAAAAL8AAAAAAAAAAAEAAABNAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADK////6QAAAAAAAAAAAf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABG02wnJgS1xwAAAABJRU5ErkJggg==]]></image>
  <mode>0</mode>
  <initcode><![CDATA[var promptService = Components.classes["@mozilla.org/embedcomp/prompt-service;1"]
                              .getService(Components.interfaces.nsIPromptService);

function selectItems(aText, aItems) {
  var selected = {};
  var result = promptService.select(null, "data:URI Generator", aText,
                                    aItems.length, aItems, selected);
  if (result) return selected.value;
  return;
}

function selectedText() {
  var focusedWindow = document.commandDispatcher.focusedWindow;
//var winWrapper = new XPCNativeWrapper(focusedWindow, "document", "getSelection()");
//var string = winWrapper.getSelection();
  var string = focusedWindow.getSelection();
  if(string == "") return;
  return string;
}

function getText() {
  var str = selectedText() || readFromClipboard();
  return str;
}

function getInput(aText, aCheckText, aFlag, aCheck) {
  return promptService.confirmEx(window, "data:URI", aText, aFlag,
                                 "Button_0", "Button_1", "Button_2",
                                 aCheckText, aCheck);
}

function getContentType() {
  var text = "MIME type";

  var type = ["Plain text", "Web page",
              "JavaScript", "CSS", "XML",
              "XUL", "Other ..."];

  var mime = ["text/plain", "text/html",
              "application/x-javascript",
              "text/css", "application/xml",
              "application/vnd.mozilla.xul+xml"];

  var index = selectItems("Select " + text, type);
  if (index != undefined) {
    if (!mime[index]) {
      var ct = prompt("Enter " + text + ", example: text/html");
      if (ct) return ct;
      return;
    }
    return mime[index];
  }
}

function getCharacterSet() {
  var text = "character set";
  var charset = ["(default)", "iso-8859-1", "utf-8",
                 "windows-1252", "Other ..."];

  var index = selectItems("Select " + text, charset);
  if (index == 0) return "";
  if (index != undefined) {
    if (index == charset.length-1) {
      var cs = prompt("Enter " + text + " or leave it blank");
      return cs;
    }
    return charset[index];
  }
}

this.getDataURI = function() {
  if(!getText()) {
    alert("No text in clipboard or no text selected.");
    return;
  }

  var title = "data:URI";
  var prefix = "data:"

  var ctype = getContentType();
  if (!ctype) return;
  prefix += ctype;

  var charset = getCharacterSet();
  if (charset == undefined) return;
  charset = charset == "" ? "" : ";charset=" + charset;
  prefix += charset;

  var checkBase64 = {value:false};
  var flagBase64 = 0;

//  var doIt = getInput(prefix, "Base 64", flagBase64, checkBase64);
//  if(doIt) return;

  var base64 = checkBase64.value;

  var encode = base64 ? encodeURIComponent(btoa(getText()))
                      : encodeURIComponent(getText());

  var dataURI = "data:" +
                ctype +
                charset +
                (base64 ? ";base64," : ",") +
                encode;

  var backgroundTab = gPrefService.getBoolPref("browser.tabs.loadInBackground");
  if (content.location == "about:blank") {
    loadURI(dataURI);
  } else {
    gBrowser.loadOneTab(dataURI, null, null, null, false);
  }

  //DTA_ContextOverlay.findLinks(false);

}

/*
this.setAttribute("homepage",
                  "http://custombuttons.phpbbnow.com/viewtopic.php?t=68#105");
*/
]]></initcode>
  <code><![CDATA[this.getDataURI();]]></code>
  <accelkey><![CDATA[]]></accelkey>
  <help><![CDATA[]]></help>
  <attributes/>
</custombutton>