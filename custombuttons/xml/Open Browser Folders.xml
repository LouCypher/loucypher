<?xml version="1.0" encoding="UTF-8"?>
<custombutton xmlns:cb="http://xsms.nm.ru/custombuttons/"
              xmlns:html="http://www.w3.org/1999/xhtml">
  <html:head>
    <html:title><![CDATA[Open Browser Folders]]></html:title>
    <html:link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACnElEQVR4Xm2RzYtbZRSHn/fr3pvJzTB3qiNM2k2pMBUGhEHaqsUqdeFGQalCobgREaFu/B/cqCtxVSjoQhBEQRBmIfWDKgNGJUPt0Nhah9JJ4iSd5E6+bu5972tAO4SS5/DjXZ1znsMrNiq1eikMQqYYJCmjxNH5+zdW777L0J5KKl9VPmnf+ut9KWkwhbheuzNcOVYOmGKc5iRO0r1ykeXCx0h7kt4fC3z5wfqbQnAJwQHa5S7jAZSRuJ0mkf81cheobhBXZa+ri1uptQjHAZoZCEC1PiPgDuwxCfwerBU7b73zXn//3usCcdt4HkZ7SGZg431U51NUCgwlO3cV/bVXhR/6p9ut+nP9QYeNn7/n8qUPZxvQ/Q6VVWHk4ZqWRvlJjpx9hcGfW2wO95N2q8m3618A2WwDt/0RplSAXsBed57eyossHl5GYdHacG3zGpADM06wjQ1UUIN+CLHPvfAxojPnKLiE+bDE1R9+5GatAmgPeGCAteQ7l5GBhGSyuROyd/gFouUyWkqEErR2mwXAAA8BRS0AgMQBjSra30ZkEeDzz9Dn4ZcvMO51SMcJcTdGChmA0ABA6cAgzyG3I8jLEBylV4fWoaeIc0V7t0Uv7pFbC+CA+28mp/8+SwXKnMVmz1O9HpE+eobMZdjcoY1GIHD/NwIdoH1fBaNguzlg88pVyoUi4vTbFI8eJxsNAIfSkrliESllH/L0v0jktNNomFGv1TFrL3Fo9QSMR3jaEEXzLC09gjaKp595No0WjyCEB4zRclICUMDxtRMce/wJ1MIi2SglXShhfI/cOjxPoZRmbq4gXzt/gVrtBrdvbiG+Wf+p/mvll1BpiVAGhCDPxuAUDotz4HKHlIJON6bRbL4hhPjcMx5mkn8BBLEUrsVZbq0AAAAASUVORK5CYII="/>
    <html:style type="text/css"><![CDATA[body { font-size: medium; margin: 0; }
body, code:before, help:before, initcode:before {
  font-family: "Verdana", sans-serif;
} 
#wrapper { position: fixed; top: 1em; right: 1em; text-align: center; }
p { font-size: small; text-align: center; }
#button {
  background-image: -moz-linear-gradient(center top, rgb(147, 200, 94) 30%, rgb(85, 168, 2) 55%);
  border: 1px outset rgb(58, 116, 4);
  border-radius: 1em;
  -moz-border-radius: 1em;
  padding: 0;
  text-shadow: 0pt -1px 0pt rgb(58, 116, 4);
  margin-bottom: 1em;
}
#button a {
  color: rgb(255, 255, 255);
  padding: 1em;
  text-decoration: none;
}
#button a, code, code:before, initcode, initcode:before, help, help:before {
  display: block;
}
#credits { position: fixed; bottom: 1em; right: 1em; font-size: small; }
custombutton { background-color: rgb(171, 171, 171); margin: 1em; }
image, mode, accelkey { display: none; }
name { font-weight: bold; font-size: x-large; }
code:before, help:before, initcode:before {
  font-weight: bold;
  font-size: large;
  margin: 0 0 1em;
  padding: .5em;
}
code:before { content: "CODE"; }
help:before { content: "Help"; }
initcode:before { content: "Initialization Code"; }
code, initcode, help {
  background-color: rgb(255, 255, 255);
  border: 1px inset rgb(170, 170, 170);
  font: medium monospace;
  margin: 1em 1em 2em 0;
  padding: 1em;
  text-align: left;
  width: 840px;
  white-space: pre-wrap;
  word-wrap: break-word;
}
.clear { clear: both; }
]]></html:style>
  </html:head>
  <html:body>
    <html:div id="wrapper">
      <html:div id="button">
        <html:a href="custombutton://%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0D%0A%3Ccustombutton%20xmlns%3Acb%3D%22http%3A//xsms.nm.ru/custombuttons/%22%3E%0A%20%20%3Cname%3EOpen%20Browser%20Folders%3C/name%3E%0A%20%20%3Cimage%3E%3C%21%5BCDATA%5Bdata%3Aimage/png%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACnElEQVR4Xm2RzYtbZRSHn/fr3pvJzTB3qiNM2k2pMBUGhEHaqsUqdeFGQalCobgREaFu/B/cqCtxVSjoQhBEQRBmIfWDKgNGJUPt0Nhah9JJ4iSd5E6+bu5972tAO4SS5/DjXZ1znsMrNiq1eikMQqYYJCmjxNH5+zdW777L0J5KKl9VPmnf+ut9KWkwhbheuzNcOVYOmGKc5iRO0r1ykeXCx0h7kt4fC3z5wfqbQnAJwQHa5S7jAZSRuJ0mkf81cheobhBXZa+ri1uptQjHAZoZCEC1PiPgDuwxCfwerBU7b73zXn//3usCcdt4HkZ7SGZg431U51NUCgwlO3cV/bVXhR/6p9ut+nP9QYeNn7/n8qUPZxvQ/Q6VVWHk4ZqWRvlJjpx9hcGfW2wO95N2q8m3618A2WwDt/0RplSAXsBed57eyossHl5GYdHacG3zGpADM06wjQ1UUIN+CLHPvfAxojPnKLiE+bDE1R9+5GatAmgPeGCAteQ7l5GBhGSyuROyd/gFouUyWkqEErR2mwXAAA8BRS0AgMQBjSra30ZkEeDzz9Dn4ZcvMO51SMcJcTdGChmA0ABA6cAgzyG3I8jLEBylV4fWoaeIc0V7t0Uv7pFbC+CA+28mp/8+SwXKnMVmz1O9HpE+eobMZdjcoY1GIHD/NwIdoH1fBaNguzlg88pVyoUi4vTbFI8eJxsNAIfSkrliESllH/L0v0jktNNomFGv1TFrL3Fo9QSMR3jaEEXzLC09gjaKp595No0WjyCEB4zRclICUMDxtRMce/wJ1MIi2SglXShhfI/cOjxPoZRmbq4gXzt/gVrtBrdvbiG+Wf+p/mvll1BpiVAGhCDPxuAUDotz4HKHlIJON6bRbL4hhPjcMx5mkn8BBLEUrsVZbq0AAAAASUVORK5CYII%3D%5D%5D%3E%3C/image%3E%0A%20%20%3Cmode%3E0%3C/mode%3E%0A%20%20%3Cinitcode%3E%3C%21%5BCDATA%5Bthis.getDir%20%3D%20function%20getDir%28aDirID%2C%20aCallback%29%20%7B%0A%20%20if%20%28%21aDirID%29%20return%3B%0A%20%20let%20dirsvc%20%3D%20Components.classes%5B%22@mozilla.org/file/directory_service%3B1%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.getService%28Components.interfaces.nsIProperties%29%3B%0A%20%20let%20dirArray%20%3D%20aDirID.split%28%22%2C%22%29%3B%0A%20%20let%20dir%20%3D%20dirsvc.get%28dirArray%5B0%5D%2C%20Components.interfaces.nsIFile%29%3B%0A%20%20if%20%28dirArray.length%20%3E%201%29%20%7B%0A%20%20%20%20for%20%28let%20i%20%3D%201%3B%20i%20%3C%20dirArray.length%3B%20i++%29%20%7B%0A%20%20%20%20%20%20dir.append%28dirArray%5Bi%5D%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%20%20//Application.console.log%28dir.path%29%3B%0A%20%20aCallback%28dir.path%29%3B%0A%7D%0A%0Athis.printDir%20%3D%20function%20printDir%28aFolder%29%20%7B%0A%20%20document.getElementById%28%22statusbar-display%22%29.label%20%3D%20aFolder%3B%0A%20%20//Application.console.log%28aFolder%29%3B%0A%7D%0A%0Athis.openDir%20%3D%20function%20openDir%28aFolder%29%20%7B%0A%20%20let%20nsLocalFile%20%3D%20Components.Constructor%28%22@mozilla.org/file/local%3B1%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22nsILocalFile%22%2C%20%22initWithPath%22%29%3B%0A%20%20%28new%20nsLocalFile%28aFolder%29%29.reveal%28%29%3B%0A%7D%0A%0Athis.popupShowing%20%3D%20function%20popupShowing%28aNode%29%20%7B%0A%20%20aNode.querySelector%28%22%5Blabel%3D%27Mail%27%5D%22%29%0A%20%20%20%20%20%20%20.hidden%20%3D%20%21%28%22toMessengerWindow%22%20in%20window%29%3B%0A%20%20aNode.querySelector%28%22%5Blabel%3D%27ChatZilla%27%5D%22%29%0A%20%20%20%20%20%20%20.hidden%20%3D%20%21%28%22toIRC%22%20in%20window%29%3B%0A%20%20aNode.querySelector%28%22%5Blabel%3D%27ColorZilla%27%5D%22%29%0A%20%20%20%20%20%20%20.hidden%20%20%3D%20%21%28%22ColorZilla%22%20in%20window%29%3B%0A%20%20aNode.querySelector%28%22%5Blabel%5E%3D%27Greasemonkey%27%5D%22%29%0A%20%20%20%20%20%20%20.hidden%20%3D%20%21%28%22GM_GUID%22%20in%20window%29%3B%0A%20%20aNode.querySelector%28%22%5Blabel%5E%3D%27User%20Agent%27%5D%22%29%0A%20%20%20%20%20%20%20.hidden%20%3D%20%21%28%22UserAgentSwitcher%22%20in%20window%29%3B%0A%7D%0A%0Alet%20menu%20%3D%20%3Cmenupopup%20xmlns%3D%7Bxulns%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20onpopupshowing%3D%22this.parentNode.popupShowing%28this%29%3B%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20onmouseout%3D%22this.parentNode.printDir%28%27%27%29%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20onmouseover%3D%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22var%20btn%3Dthis.parentNode%3B%20%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22btn.getDir%28event.target.value%2C%20btn.printDir%29%3B%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20oncommand%3D%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22var%20btn%3Dthis.parentNode%3B%20%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22btn.getDir%28event.target.value%2C%20btn.openDir%29%3B%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cmenuitem%20label%3D%22Profile%20Folder%22%20value%3D%22ProfD%22/%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cmenuitem%20label%3D%7BApplication.name%20+%20%22%20Folder%22%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%3D%22CurProcD%22/%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cmenuseparator/%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cmenuitem%20label%3D%22Bookmark%20Backups%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%3D%22ProfD%2Cbookmarkbackups%22/%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cmenuitem%20label%3D%22Chrome%22%20value%3D%22UChrm%22/%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cmenuitem%20label%3D%22Extensions%22%20value%3D%22ProfD%2Cextensions%22/%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cmenuitem%20label%3D%22Mail%22%20value%3D%22ProfD%2CMail%22/%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cmenuitem%20label%3D%22Search%20Plugins%22%20value%3D%22UsrSrchPlugns%22/%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cmenuseparator/%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cmenuitem%20label%3D%22ChatZilla%22%20value%3D%22ProfD%2Cchatzilla%22/%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cmenuitem%20label%3D%22Custom%20Buttons%22%20value%3D%22ProfD%2Ccustombuttons%22/%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cmenuitem%20label%3D%22ColorZilla%22%20value%3D%22ProfD%2Ccolorzilla%2Cpalettes%22/%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cmenuitem%20label%3D%22Greasemonkey%20Scripts%22%20value%3D%22ProfD%2Cgm_scripts%22/%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cmenuitem%20label%3D%22User%20Agent%20Switcher%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20value%3D%22ProfD%2Cuseragentswitcher%22/%3E%0A%20%20%20%20%20%20%20%20%20%20%20%3C/menupopup%3E%3B%0A%0Athis.appendChild%28cbu.makeXML%28menu%29%29%3B%0Athis.type%20%3D%20%22menu%22%0A%0A////////////////////////////////////////////////////////////////////////////%0A//////////////////////////////%20Button%20updater%20//////////////////////////////%0A////////////////////////////////////////////////////////////////////////////%0A%0A/*%20*****%20BEGIN%20LICENSE%20BLOCK%20*****%0A%20*%20Version%3A%20MPL%201.1/GPL%202.0/LGPL%202.1%0A%20*%0A%20*%20The%20contents%20of%20this%20file%20are%20subject%20to%20the%20Mozilla%20Public%20License%0A%20*%20Version%201.1%20%28the%20%22License%22%29%3B%20you%20may%20not%20use%20this%20file%20except%20in%0A%20*%20compliance%20with%20the%20License.%20You%20may%20obtain%20a%20copy%20of%20the%20License%20at%0A%20*%20http%3A//www.mozilla.org/MPL/%0A%20*%0A%20*%20Software%20distributed%20under%20the%20License%20is%20distributed%20on%20an%20%22AS%20IS%22%20basis%2C%0A%20*%20WITHOUT%20WARRANTY%20OF%20ANY%20KIND%2C%20either%20express%20or%20implied.%20See%20the%20License%0A%20*%20for%20the%20specific%20language%20governing%20rights%20and%20limitations%20under%20the%0A%20*%20License.%0A%20*%0A%20*%20Original%20code%20is%20Button%20Updater%20for%20Custom%20Buttons%20extension%0A%20*%0A%20*%20The%20Initial%20Developer%20of%20the%20Original%20Code%20is%20LouCypher.%0A%20*%20Portions%20created%20by%20the%20Initial%20Developer%20are%20Copyright%20%28C%29%202011%0A%20*%20the%20Initial%20Developer.%20All%20Rights%20Reserved.%0A%20*%0A%20*%20Contributor%28s%29%3A%0A%20*%20-%20LouCypher%3A%20original%20code%0A%20*%0A%20*%20Alternatively%2C%20the%20contents%20of%20this%20file%20may%20be%20used%20under%20the%20terms%20of%0A%20*%20either%20the%20GNU%20General%20Public%20License%20Version%202%20or%20later%20%28the%20%22GPL%22%29%2C%0A%20*%20in%20which%20case%20the%20provisions%20of%20the%20GPL%20are%20applicable%20instead%20of%20those%0A%20*%20above.%0A%20*%0A%20*%20*****%20END%20LICENSE%20BLOCK%20*****%20*/%0A%0Athis.updateURL%20%3D%20%22http%3A//loucypher.googlecode.com/svn/custombuttons/xml/%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20encodeURIComponent%28this.name%29%20+%20%22.xml%22%3B%0A%0Avar%20btnClick%20%3D%20this.onclick%3B%0Avar%20btnIcon%20%3D%20this.image%3B%0Avar%20Button%20%3D%20this%3B%0A%0Athis.updater%20%3D%20%7B%0A%0A%20%20get%20bsyIcon%28%29%20%7B%0A%20%20%20%20return%20%20Application.name%20%3D%3D%20%22Firefox%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%3F%20Application.version%20%3E%3D%20%224%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3F%20%22chrome%3A//browser/skin/tabbrowser/connecting.png%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20%22chrome%3A//global/skin/icons/loading_16.png%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%3A%20Application.name%20%3D%3D%20%22SeaMonkey%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3F%20%22chrome%3A//communicator/skin/icons/loading.gif%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20%22chrome%3A//custombuttons/skin/button.png%22%3B%0A%20%20%7D%2C%0A%0A%20%20isValidCbURI%3A%20function%20isValidCbURI%28aURL%29%20%7B%0A%20%20%20%20if%20%28%21aURL%29%20return%20false%3B%0A%20%20%20%20return%20/%5Ecustombutton%5C%3A%5C/%5C//.test%28aURL%29%3B%0A%20%20%7D%2C%0A%0A%20%20convertURItoDOM%3A%20function%20convertURItoDOM%28aURL%29%20%7B%0A%20%20%20%20if%20%28%21this.isValidCbURI%28aURL%29%29%20%7B%0A%20%20%20%20%20%20custombuttons.alertBox%28Button.name%2C%20%22Not%20a%20Custom%20Buttons%20link%21%22%29%3B%0A%20%20%20%20%20%20return%3B%0A%20%20%20%20%7D%0A%20%20%20%20var%20string%20%3D%20unescape%28aURL.replace%28/%5Ecustombutton%5C%3A%5C/%5C//%2C%20%22%22%29.toString%28%29%29%3B%0A%20%20%20%20var%20parser%20%3D%20new%20DOMParser%28%29%3B%0A%20%20%20%20var%20dom%20%3D%20parser.parseFromString%28string%2C%20%22text/xml%22%29%3B%0A%20%20%20%20if%20%28dom.documentElement.nodeName%20%3D%3D%20%22parsererror%22%29%20%7B%0A%20%20%20%20%20%20return%20null%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20return%20dom.documentElement%3B%0A%20%20%20%20%7D%0A%20%20%7D%2C%0A%0A%20%20getParamValue%3A%20function%20getParamValue%28aDocument%2C%20aNodeName%29%20%7B%0A%20%20%20%20var%20node%20%3D%20aDocument.querySelector%28aNodeName%29%3B%0A%20%20%20%20if%20%28%21node%29%20return%20%22%22%3B%0A%20%20%20%20if%20%28%21node.firstChild%20%7C%7C%20%28node.firstChild%20%26%26%0A%20%20%20%20%20%20%20%20%28node.firstChild.nodeType%20%3D%3D%20node.TEXT_NODE%29%29%29%20%7B%0A%20%20%20%20%20%20return%20node.textContent%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20return%20node.firstChild.textContent%3B%0A%20%20%20%20%7D%0A%20%20%7D%2C%0A%0A%20%20getButtonParameters%3A%20function%20getButtonParameters%28aButtonLink%2C%20aURL%29%20%7B%0A%20%20%20%20var%20dom%20%3D%20this.convertURItoDOM%28aURL%29%3B%0A%20%20%20%20var%20params%20%3D%20custombuttons.cbService.getButtonParameters%28aButtonLink%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.wrappedJSObject%3B%0A%20%20%20%20params.name%20%20%20%20%20%20%20%20%20%20%20%20%20%3D%20this.getParamValue%28dom%2C%20%22name%22%29%0A%20%20%20%20params.image%20%20%20%20%20%20%20%20%20%20%20%20%3D%20this.getParamValue%28dom%2C%20%22image%22%29%20%7C%7C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20this.getParamValue%28dom%2C%20%22stdicon%22%29%3B%0A%20%20%20%20params.code%20%20%20%20%20%20%20%20%20%20%20%20%20%3D%20this.getParamValue%28dom%2C%20%22code%22%29%0A%20%20%20%20params.initCode%20%20%20%20%20%20%20%20%20%3D%20this.getParamValue%28dom%2C%20%22initcode%22%29%0A%20%20%20%20params.help%20%20%20%20%20%20%20%20%20%20%20%20%20%3D%20this.getParamValue%28dom%2C%20%22help%22%29%0A%20%20%20%20params.accelkey%20%20%20%20%20%20%20%20%20%3D%20this.getParamValue%28dom%2C%20%22accelkey%22%29%0A%20%20%20%20params.mode%20%20%20%20%20%20%20%20%20%20%20%20%20%3D%20this.getParamValue%28dom%2C%20%22mode%22%29%0A%20%20%20%20params.wrappedJSObject%20%20%3D%20params%3B%0A%20%20%20%20return%20params%3B%0A%20%20%7D%2C%0A%0A%20%20resetAttributes%3A%20function%20resetAttributes%28%29%20%7B%0A%20%20%20%20Button.image%20%3D%20btnIcon%3B%0A%20%20%20%20Button.tooltipText%20%3D%20Button.name%3B%0A%20%20%20%20Button.removeAttribute%28%22busy%22%29%3B%0A%20%20%20%20Button.onclick%20%3D%20btnClick%3B%0A%20%20%7D%2C%0A%0A%20%20checkForUpdate%3A%20function%20checkForUpdate%28aCallback%29%20%7B%0A%20%20%20%20var%20url%20%3D%20Button.updateURL%20+%20%22%3F%22%20+%20Date.now%28%29%3B%0A%20%20%20%20var%20req%20%3D%20new%20XMLHttpRequest%28%29%3B%0A%20%20%20%20req.open%28%22GET%22%2C%20url%2C%20true%29%3B%0A%20%20%20%20if%20%28Button.hasAttribute%28%22busy%22%29%29%20%7B%0A%20%20%20%20%20%20this.resetAttributes%28%29%3B%0A%20%20%20%20%20%20return%0A%20%20%20%20%7D%0A%20%20%20%20var%20updater%20%3D%20this%3B%0A%20%20%20%20req.onreadystatechange%20%3D%20function%20%28aEvent%29%20%7B%0A%20%20%20%20%20%20Button.onclick%20%3D%20function%28aEvent%29%20%7B%0A%20%20%20%20%20%20%20%20aEvent.preventDefault%28%29%3B%0A%20%20%20%20%20%20%20%20req.abort%28%29%3B%0A%20%20%20%20%20%20%20%20this.updater.resetAttributes%28%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20Button.image%20%3D%20updater.bsyIcon%3B%0A%20%20%20%20%20%20Button.setAttribute%28%22busy%22%2C%20%22%22%29%3B%0A%20%20%20%20%20%20Button.tooltipText%20%3D%20%22Checking%20for%20update...%5CnClick%20to%20abort.%22%3B%0A%20%20%20%20%20%20if%20%28req.readyState%20%3D%3D%204%20%26%26%20req.status%20%3D%3D%20200%29%20%7B%0A%20%20%20%20%20%20%20%20updater.resetAttributes%28%29%3B%0A%20%20%20%20%20%20%20%20aCallback%28req.responseXML%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20req.send%28null%29%3B%0A%20%20%7D%2C%0A%0A%20%20getUpdate%3A%20function%20getUpdate%28aDocument%29%20%7B%0A%20%20%20%20if%20%28aDocument.documentElement.localName%20%21%3D%20%22custombutton%22%29%20%7B%0A%20%20%20%20%20%20alert%28%22Not%20a%20valid%20Custom%20Buttons%20XML%20file%21%22%29%3B%0A%20%20%20%20%20%20return%3B%0A%20%20%20%20%7D%0A%20%20%20%20let%20button%20%3D%20aDocument.getElementById%28%22button%22%29%3B%0A%20%20%20%20let%20link%20%3D%20button.getElementsByTagNameNS%28xhtmlns%2C%20%22a%22%29%5B0%5D%3B%0A%20%20%20%20if%20%28link.href%20%3D%3D%20Button.URI%29%20%7B%0A%20%20%20%20%20%20let%20as%20%3D%20Cc%5B%27@mozilla.org/alerts-service%3B1%27%5D.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20getService%28Ci.nsIAlertsService%29%3B%0A%20%20%20%20%20%20as.showAlertNotification%28btnIcon%2C%20%22No%20update%20found%21%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Finish%20checking%22%2C%20false%2C%20%22%22%2C%20null%29%3B%0A%20%20%20%20%20%20return%3B%0A%20%20%20%20%7D%20%0A%20%20%20%20let%20install%20%3D%20custombuttons.confirmBox%28Button.name%2C%20%22Update%20found%21%20%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Update%20%27%22%20+%20Button.name%20+%20%22%27%3F%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Yes%22%2C%20%22No%22%29%3B%0A%20%20%20%20if%20%28%21install%29%20return%3B%0A%20%20%20%20let%20btnLink%20%3D%20custombuttons.makeButtonLink%28%22update%22%2C%20Button.id%29%3B%0A%20%20%20%20let%20params%20%3D%20Button.updater.getButtonParameters%28btnLink%2C%20link.href%29%3B%0A%20%20%20%20custombuttons.cbService.installButton%28params%29%3B%0A%20%20%20%20custombuttons.alertBox%28Button.name%2C%20%22Button%20updated%21%22%29%3B%0A%20%20%20%20Button.setAttribute%28%22cb-edit-state%22%2C%20%22active%22%29%3B%0A%20%20%7D%0A%7D%0A%0Alet%20items%20%3D%20%5B%0A%20%20%3Cmenuseparator%20xmlns%3D%7Bxulns%7D/%3E%2C%0A%20%20%3Cmenuitem%20xmlns%3D%7Bxulns%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20label%3D%22Check%20for%20updates%20for%20this%20button%22%0A%20%20%20%20%20%20%20%20%20%20%20%20oncommand%3D%7B%22var%20btn%20%3D%20this.parentNode.parentNode%3B%20%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22btn.updater.checkForUpdate%28btn.updater.getUpdate%29%3B%22%7D/%3E%0A%5D%0A%0Afor%20%28var%20i%20%3D%200%3B%20i%20%3C%20items.length%3B%20i++%29%20%7B%0A%20%20this.firstChild.appendChild%28cbu.makeXML%28items%5Bi%5D%29%29%3B%0A%7D%0A%5D%5D%3E%3C/initcode%3E%0A%20%20%3Ccode%3E%3C%21%5BCDATA%5B/*%0A%20%20References%3A%0A%20%20%20%20-%20http%3A//mxr.mozilla.org/mozilla-central/source/toolkit/content/aboutSupport.js%23510%0A%20%20%20%20-%20http%3A//mxr.mozilla.org/mozilla-central/source/xpcom/io/nsDirectoryServiceDefs.h%0A%20%20%20%20-%20http%3A//mxr.mozilla.org/mozilla-central/source/xpcom/io/nsAppDirectoryServiceDefs.h%0A*/%0A%5D%5D%3E%3C/code%3E%0A%20%20%3Caccelkey%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/accelkey%3E%0A%20%20%3Chelp%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/help%3E%0A%20%20%3Cattributes/%3E%0A%3C/custombutton%3E" rel="nofollow" title="Open Browser Folders">
        <![CDATA[Install this button]]>
        </html:a>
      </html:div>
      <html:a href="https://addons.mozilla.org/addon/custom-buttons/">
        <![CDATA[What's this?]]>
      </html:a>
      <html:div id="credits">
        <html:a href="http://custombuttons.mozdev.org/drupal/node/484">
          <![CDATA[Custom Buttons XML]]><html:br/><![CDATA[Exporter/Importer]]>
        </html:a>
      </html:div>
    </html:div>
  </html:body>

  <name>Open Browser Folders</name>
  <image><![CDATA[data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACnElEQVR4Xm2RzYtbZRSHn/fr3pvJzTB3qiNM2k2pMBUGhEHaqsUqdeFGQalCobgREaFu/B/cqCtxVSjoQhBEQRBmIfWDKgNGJUPt0Nhah9JJ4iSd5E6+bu5972tAO4SS5/DjXZ1znsMrNiq1eikMQqYYJCmjxNH5+zdW777L0J5KKl9VPmnf+ut9KWkwhbheuzNcOVYOmGKc5iRO0r1ykeXCx0h7kt4fC3z5wfqbQnAJwQHa5S7jAZSRuJ0mkf81cheobhBXZa+ri1uptQjHAZoZCEC1PiPgDuwxCfwerBU7b73zXn//3usCcdt4HkZ7SGZg431U51NUCgwlO3cV/bVXhR/6p9ut+nP9QYeNn7/n8qUPZxvQ/Q6VVWHk4ZqWRvlJjpx9hcGfW2wO95N2q8m3618A2WwDt/0RplSAXsBed57eyossHl5GYdHacG3zGpADM06wjQ1UUIN+CLHPvfAxojPnKLiE+bDE1R9+5GatAmgPeGCAteQ7l5GBhGSyuROyd/gFouUyWkqEErR2mwXAAA8BRS0AgMQBjSra30ZkEeDzz9Dn4ZcvMO51SMcJcTdGChmA0ABA6cAgzyG3I8jLEBylV4fWoaeIc0V7t0Uv7pFbC+CA+28mp/8+SwXKnMVmz1O9HpE+eobMZdjcoY1GIHD/NwIdoH1fBaNguzlg88pVyoUi4vTbFI8eJxsNAIfSkrliESllH/L0v0jktNNomFGv1TFrL3Fo9QSMR3jaEEXzLC09gjaKp595No0WjyCEB4zRclICUMDxtRMce/wJ1MIi2SglXShhfI/cOjxPoZRmbq4gXzt/gVrtBrdvbiG+Wf+p/mvll1BpiVAGhCDPxuAUDotz4HKHlIJON6bRbL4hhPjcMx5mkn8BBLEUrsVZbq0AAAAASUVORK5CYII=]]></image>
  <mode>0</mode>
  <initcode><![CDATA[this.getDir = function getDir(aDirID, aCallback) {
  if (!aDirID) return;
  let dirsvc = Components.classes["@mozilla.org/file/directory_service;1"]
                         .getService(Components.interfaces.nsIProperties);
  let dirArray = aDirID.split(",");
  let dir = dirsvc.get(dirArray[0], Components.interfaces.nsIFile);
  if (dirArray.length > 1) {
    for (let i = 1; i < dirArray.length; i++) {
      dir.append(dirArray[i]);
    }
  }
  //Application.console.log(dir.path);
  aCallback(dir.path);
}

this.printDir = function printDir(aFolder) {
  document.getElementById("statusbar-display").label = aFolder;
  //Application.console.log(aFolder);
}

this.openDir = function openDir(aFolder) {
  let nsLocalFile = Components.Constructor("@mozilla.org/file/local;1",
                                           "nsILocalFile", "initWithPath");
  (new nsLocalFile(aFolder)).reveal();
}

this.popupShowing = function popupShowing(aNode) {
  aNode.querySelector("[label='Mail']")
       .hidden = !("toMessengerWindow" in window);
  aNode.querySelector("[label='ChatZilla']")
       .hidden = !("toIRC" in window);
  aNode.querySelector("[label='ColorZilla']")
       .hidden  = !("ColorZilla" in window);
  aNode.querySelector("[label^='Greasemonkey']")
       .hidden = !("GM_GUID" in window);
  aNode.querySelector("[label^='User Agent']")
       .hidden = !("UserAgentSwitcher" in window);
}

let menu = <menupopup xmlns={xulns}
                      onpopupshowing="this.parentNode.popupShowing(this);"
                      onmouseout="this.parentNode.printDir('')"
                      onmouseover={
                        "var btn=this.parentNode; " +
                        "btn.getDir(event.target.value, btn.printDir);"
                      }
                      oncommand={
                        "var btn=this.parentNode; " +
                        "btn.getDir(event.target.value, btn.openDir);"
                      }>
             <menuitem label="Profile Folder" value="ProfD"/>
             <menuitem label={Application.name + " Folder"}
                       value="CurProcD"/>
             <menuseparator/>
             <menuitem label="Bookmark Backups"
                       value="ProfD,bookmarkbackups"/>
             <menuitem label="Chrome" value="UChrm"/>
             <menuitem label="Extensions" value="ProfD,extensions"/>
             <menuitem label="Mail" value="ProfD,Mail"/>
             <menuitem label="Search Plugins" value="UsrSrchPlugns"/>
             <menuseparator/>
             <menuitem label="ChatZilla" value="ProfD,chatzilla"/>
             <menuitem label="Custom Buttons" value="ProfD,custombuttons"/>
             <menuitem label="ColorZilla" value="ProfD,colorzilla,palettes"/>
             <menuitem label="Greasemonkey Scripts" value="ProfD,gm_scripts"/>
             <menuitem label="User Agent Switcher"
                       value="ProfD,useragentswitcher"/>
           </menupopup>;

this.appendChild(cbu.makeXML(menu));
this.type = "menu"

////////////////////////////////////////////////////////////////////////////
////////////////////////////// Button updater //////////////////////////////
////////////////////////////////////////////////////////////////////////////

/* ***** BEGIN LICENSE BLOCK *****
 * Version: MPL 1.1/GPL 2.0/LGPL 2.1
 *
 * The contents of this file are subject to the Mozilla Public License
 * Version 1.1 (the "License"); you may not use this file except in
 * compliance with the License. You may obtain a copy of the License at
 * http://www.mozilla.org/MPL/
 *
 * Software distributed under the License is distributed on an "AS IS" basis,
 * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
 * for the specific language governing rights and limitations under the
 * License.
 *
 * Original code is Button Updater for Custom Buttons extension
 *
 * The Initial Developer of the Original Code is LouCypher.
 * Portions created by the Initial Developer are Copyright (C) 2011
 * the Initial Developer. All Rights Reserved.
 *
 * Contributor(s):
 * - LouCypher: original code
 *
 * Alternatively, the contents of this file may be used under the terms of
 * either the GNU General Public License Version 2 or later (the "GPL"),
 * in which case the provisions of the GPL are applicable instead of those
 * above.
 *
 * ***** END LICENSE BLOCK ***** */

this.updateURL = "http://loucypher.googlecode.com/svn/custombuttons/xml/" +
                 encodeURIComponent(this.name) + ".xml";

var btnClick = this.onclick;
var btnIcon = this.image;
var Button = this;

this.updater = {

  get bsyIcon() {
    return  Application.name == "Firefox"
            ? Application.version >= "4"
              ? "chrome://browser/skin/tabbrowser/connecting.png"
              : "chrome://global/skin/icons/loading_16.png"
            : Application.name == "SeaMonkey"
              ? "chrome://communicator/skin/icons/loading.gif"
              : "chrome://custombuttons/skin/button.png";
  },

  isValidCbURI: function isValidCbURI(aURL) {
    if (!aURL) return false;
    return /^custombutton\:\/\//.test(aURL);
  },

  convertURItoDOM: function convertURItoDOM(aURL) {
    if (!this.isValidCbURI(aURL)) {
      custombuttons.alertBox(Button.name, "Not a Custom Buttons link!");
      return;
    }
    var string = unescape(aURL.replace(/^custombutton\:\/\//, "").toString());
    var parser = new DOMParser();
    var dom = parser.parseFromString(string, "text/xml");
    if (dom.documentElement.nodeName == "parsererror") {
      return null;
    } else {
      return dom.documentElement;
    }
  },

  getParamValue: function getParamValue(aDocument, aNodeName) {
    var node = aDocument.querySelector(aNodeName);
    if (!node) return "";
    if (!node.firstChild || (node.firstChild &&
        (node.firstChild.nodeType == node.TEXT_NODE))) {
      return node.textContent;
    } else {
      return node.firstChild.textContent;
    }
  },

  getButtonParameters: function getButtonParameters(aButtonLink, aURL) {
    var dom = this.convertURItoDOM(aURL);
    var params = custombuttons.cbService.getButtonParameters(aButtonLink)
                                        .wrappedJSObject;
    params.name             = this.getParamValue(dom, "name")
    params.image            = this.getParamValue(dom, "image") ||
                              this.getParamValue(dom, "stdicon");
    params.code             = this.getParamValue(dom, "code")
    params.initCode         = this.getParamValue(dom, "initcode")
    params.help             = this.getParamValue(dom, "help")
    params.accelkey         = this.getParamValue(dom, "accelkey")
    params.mode             = this.getParamValue(dom, "mode")
    params.wrappedJSObject  = params;
    return params;
  },

  resetAttributes: function resetAttributes() {
    Button.image = btnIcon;
    Button.tooltipText = Button.name;
    Button.removeAttribute("busy");
    Button.onclick = btnClick;
  },

  checkForUpdate: function checkForUpdate(aCallback) {
    var url = Button.updateURL + "?" + Date.now();
    var req = new XMLHttpRequest();
    req.open("GET", url, true);
    if (Button.hasAttribute("busy")) {
      this.resetAttributes();
      return
    }
    var updater = this;
    req.onreadystatechange = function (aEvent) {
      Button.onclick = function(aEvent) {
        aEvent.preventDefault();
        req.abort();
        this.updater.resetAttributes();
      }
      Button.image = updater.bsyIcon;
      Button.setAttribute("busy", "");
      Button.tooltipText = "Checking for update...\nClick to abort.";
      if (req.readyState == 4 && req.status == 200) {
        updater.resetAttributes();
        aCallback(req.responseXML);
      }
    }
    req.send(null);
  },

  getUpdate: function getUpdate(aDocument) {
    if (aDocument.documentElement.localName != "custombutton") {
      alert("Not a valid Custom Buttons XML file!");
      return;
    }
    let button = aDocument.getElementById("button");
    let link = button.getElementsByTagNameNS(xhtmlns, "a")[0];
    if (link.href == Button.URI) {
      let as = Cc['@mozilla.org/alerts-service;1'].
               getService(Ci.nsIAlertsService);
      as.showAlertNotification(btnIcon, "No update found!",
                               "Finish checking", false, "", null);
      return;
    } 
    let install = custombuttons.confirmBox(Button.name, "Update found! " +
                                           "Update '" + Button.name + "'?",
                                           "Yes", "No");
    if (!install) return;
    let btnLink = custombuttons.makeButtonLink("update", Button.id);
    let params = Button.updater.getButtonParameters(btnLink, link.href);
    custombuttons.cbService.installButton(params);
    custombuttons.alertBox(Button.name, "Button updated!");
    Button.setAttribute("cb-edit-state", "active");
  }
}

let items = [
  <menuseparator xmlns={xulns}/>,
  <menuitem xmlns={xulns}
            label="Check for updates for this button"
            oncommand={"var btn = this.parentNode.parentNode; " +
              "btn.updater.checkForUpdate(btn.updater.getUpdate);"}/>
]

for (var i = 0; i < items.length; i++) {
  this.firstChild.appendChild(cbu.makeXML(items[i]));
}
]]></initcode>
  <code><![CDATA[/*
  References:
    - http://mxr.mozilla.org/mozilla-central/source/toolkit/content/aboutSupport.js#510
    - http://mxr.mozilla.org/mozilla-central/source/xpcom/io/nsDirectoryServiceDefs.h
    - http://mxr.mozilla.org/mozilla-central/source/xpcom/io/nsAppDirectoryServiceDefs.h
*/
]]></code>
  <accelkey><![CDATA[]]></accelkey>
  <help><![CDATA[]]></help>
  <attributes/>
</custombutton>