<?xml version="1.0" encoding="UTF-8"?>
<custombutton xmlns:cb="http://xsms.nm.ru/custombuttons/"
              xmlns:html="http://www.w3.org/1999/xhtml">
  <html:head>
    <html:title><![CDATA[DOM Inspector]]></html:title>
    <html:link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAB3RJTUUH1QgECxw1jaSNNQAAAAlwSFlzAAAK8AAACvABQqw0mAAAADBQTFRFAAAA/wAA/20A/4UA/60AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwJ3q+AAAAEFJREFUeNpjYIABFhcwcAAxGBggDAYlJQYwg0lJSQHEcFACAhZ0hhEKA6jYWACunQVqoAODA9QKuF0OcEvhjmAAAOEEEW5k07z8AAAAAElFTkSuQmCC"/>
    <html:style type="text/css"><![CDATA[body { font-size: medium; margin: 0; }
body, code:before, help:before, initcode:before {
  font-family: "Verdana", sans-serif;
} 
#wrapper { position: fixed; top: 1em; right: 1em; text-align: center; }
p { font-size: small; text-align: center; }
#button {
  background-image: -moz-linear-gradient(center top, rgb(147, 200, 94) 30%, rgb(85, 168, 2) 55%);
  border: 1px outset rgb(58, 116, 4);
  border-radius: 1em;
  padding: 0;
  text-shadow: 0pt -1px 0pt rgb(58, 116, 4);
  margin-bottom: 1em;
}
#button a {
  color: rgb(255, 255, 255);
  padding: 1em;
  text-decoration: none;
}
#button a, code, code:before, initcode, initcode:before, help, help:before {
  display: block;
}
#credits { position: fixed; bottom: 1em; right: 1em; font-size: small; }
custombutton { background-color: rgb(171, 171, 171); margin: 1em; }
image, mode, accelkey { display: none; }
name { font-weight: bold; font-size: x-large; }
code:before, help:before, initcode:before {
  font-weight: bold;
  font-size: large;
  margin: 0 0 1em;
  padding: .5em;
}
code:before { content: "CODE"; }
help:before { content: "Help"; }
initcode:before { content: "Initialization Code"; }
code, initcode, help {
  background-color: rgb(255, 255, 255);
  border: 1px inset rgb(170, 170, 170);
  font: medium monospace;
  margin: 1em 1em 2em 0;
  padding: 1em;
  text-align: left;
  width: 840px;
  white-space: pre-wrap;
  word-wrap: break-word;
}
.clear { clear: both; }
]]></html:style>
  </html:head>
  <html:body>
    <html:div id="wrapper">
      <html:div id="button">
        <html:a href="custombutton://%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0D%0A%3Ccustombutton%20xmlns%3Acb%3D%22http%3A//xsms.nm.ru/custombuttons/%22%3E%0A%20%20%3Cname%3EDOM%20Inspector%3C/name%3E%0A%20%20%3Cimage%3E%3C%21%5BCDATA%5Bdata%3Aimage/png%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAB3RJTUUH1QgECxw1jaSNNQAAAAlwSFlzAAAK8AAACvABQqw0mAAAADBQTFRFAAAA/wAA/20A/4UA/60AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwJ3q+AAAAEFJREFUeNpjYIABFhcwcAAxGBggDAYlJQYwg0lJSQHEcFACAhZ0hhEKA6jYWACunQVqoAODA9QKuF0OcEvhjmAAAOEEEW5k07z8AAAAAElFTkSuQmCC%5D%5D%3E%3C/image%3E%0A%20%20%3Cmode%3E0%3C/mode%3E%0A%20%20%3Cinitcode%3E%3C%21%5BCDATA%5B%0A//%20Check%20if%20DOM%20Inspector%20is%20installed%20and%20enabled%0Aif%20%28typeof%20inspectDOMDocument%20%21%3D%20%22function%22%29%20%7B%0A%20%20this.tooltipText%20%3D%20%22DOM%20Inspector%20extension%20is%20not%20installed%20or%20is%20disabled.%22%3B%0A%20%20this.disabled%20%3D%20true%3B%0A%20%20return%3B%0A%7D%0A%0A//%20Append%20menuitems%0Afunction%20addItem%28aNode%2C%20aLabel%2C%20aKey%2C%20aStatus%2C%20aValue%29%20%7B%0A%20%20aNode.appendChild%28cbu.makeXML%28%3Cmenuitem%20xmlns%3D%7Bxulns%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20label%3D%7BaLabel%7D%20statustext%3D%7BaStatus%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20accesskey%3D%7BaKey%7D%20value%3D%7BaValue%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20context%3D%22toolbar-context-menu%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20oncommand%3D%22this.parentNode.parentNode.inspectWin%28event%29%3B%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20onmouseover%3D%22this.parentNode.parentNode.setStatus%28this.statusText%29%3B%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20onmouseout%3D%22this.parentNode.parentNode.setStatus%28%27%27%29%3B%22/%3E%29%29%3B%0A%7D%0A%0A//%20Enumerate%20open%20windows%0Afunction%20getWindowEnumerator%28%29%20%7B%0A%20%20return%20Components.classes%5B%22@mozilla.org/embedcomp/window-watcher%3B1%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.getService%28Components.interfaces.nsIWindowWatcher%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.getWindowEnumerator%28%29%3B%0A%7D%0A%0A//%20Display%20window%20URL%20on%20statusbar%0Athis.setStatus%20%3D%20function%28aString%29%20%7B%0A%20%20document.getElementById%28%22statusbar-display%22%29.label%20%3D%20aString%3B%0A%7D%0A%0A//%20Regenerate%20menuitems%0Athis.popupShowing%20%3D%20function%28aNode%29%20%7B%0A%20%20while%20%28aNode.lastChild%29%20%7B%0A%20%20%20%20aNode.removeChild%28aNode.lastChild%29%3B%0A%20%20%7D%0A%20%20var%20index%20%3D%201%3B%0A%20%20var%20enumerator%20%3D%20getWindowEnumerator%28%29%3B%0A%20%20while%20%28enumerator.hasMoreElements%28%29%29%20%7B%0A%20%20%20%20let%20win%20%3D%20enumerator.getNext%28%29%3B%0A%20%20%20%20addItem%28aNode%2C%20index%20+%20%22%20%22%20+%20win.document.title%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20index%2C%20win.location%2C%20index++%29%3B%0A%20%20%7D%0A%7D%0A%0A//%20Inspect%20document/window%0Athis.inspectWin%20%3D%20function%28aEvent%29%20%7B%0A%20%20if%20%28aEvent%29%20%7B%0A%20%20%20%20if%20%28aEvent.target.nodeName%20%21%3D%20%22toolbarbutton%22%29%20%7B%0A%20%20%20%20%20%20var%20windowIndex%20%3D%20parseInt%28aEvent.target.getAttribute%28%22value%22%29%29%3B%0A%20%20%20%20%20%20var%20enumerator%20%3D%20getWindowEnumerator%28%29%3B%0A%20%20%20%20%20%20var%20index%20%3D%201%3B%0A%20%20%20%20%20%20while%20%28enumerator.hasMoreElements%28%29%29%20%7B%0A%20%20%20%20%20%20%20%20let%20win%20%3D%20enumerator.getNext%28%29%3B%0A%20%20%20%20%20%20%20%20if%20%28index++%20%3D%3D%20windowIndex%29%20%7B%0A%20%20%20%20%20%20%20%20%20%20inspectDOMDocument%28win.document%29%3B%0A%20%20%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%20else%20%7B%0A%20%20%20%20//%20Inspect%20document%20in%20active%20tab%0A%20%20%20%20inspectDOMDocument%28content.document%29%3B%0A%20%20%7D%0A%7D%0A%0A//%20Middle%20click%20to%20inspect%20chrome%20instead%20of%20content%0Athis.setAttribute%28%22onclick%22%2C%20%22if%20%28event.button%20%3D%3D%201%29%20inspectDOMDocument%28document.documentElement%29%3B%22%29%3B%0A%0Athis.appendChild%28cbu.makeXML%28%3Cmenupopup%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20xmlns%3D%7Bxulns%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20oncommand%3D%22event.stopPropagation%28%29%3B%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20onpopupshowing%3D%22this.parentNode.popupShowing%28this%29%3B%22/%3E%29%29%3B%0A%0Athis.type%20%3D%20%22menu-button%22%3B%0A%0A%0A//-------------------------%20Add%20%22Inspect%20Element%22%20-------------------------%0A%0A//%20Remove%20element%20if%20it%20exists%0Afunction%20removeNode%28aId%29%20%7B%0A%20%20var%20node%20%3D%20document.getElementById%28aId%29%3B%0A%20%20if%20%28node%29%20%7B%0A%20%20%20%20node.parentNode.removeChild%28node%29%3B%0A%20%20%7D%0A%7D%0A%0A//%20Append%20menuitem%20into%20a%20menupopup%0Afunction%20addInspector%28aMenupopup%2C%20aId%2C%20aImage%29%20%7B%0A%20%20//%20Remove%20previously%20created%20menuitem%0A%20%20//%20to%20avoid%20duplicate%20during%20button%20initiation%0A%20%20removeNode%28aId%29%3B%0A%0A%20%20//%20Create%20a%20new%20one%0A%20%20aMenupopup.appendChild%28cbu.makeXML%28%3Cmenuitem%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20xmlns%3D%7Bxulns%7D%20id%3D%7BaId%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20class%3D%22menuitem-iconic%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20image%3D%7BaImage%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20label%3D%22Inspect%20Element%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20oncommand%3D%22inspectDOMNode%28document.popupNode%29%3B%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20onclick%3D%22if%20%28event.button%20%3D%3D%201%29%20%7B%20inspectObject%28document.popupNode%29%3B%20closeMenus%28this%29%3B%20%7D%22%20/%3E%29%29%3B%0A%7D%0A%0Avar%20id%20%3D%20%22inspector-%22%3B%0Avar%20popupset%20%3D%20document.getElementById%28%22mainPopupSet%22%29%3B%0A%0Avar%20menupopups%20%3D%20popupset.getElementsByTagName%28%22menupopup%22%29%3B%0Afor%20%28var%20i%20%3D%200%3B%20i%20%3C%20menupopups.length%3B%20i++%29%20%7B%0A%20%20let%20menupopup%20%3D%20menupopups%5Bi%5D%3B%0A%20%20if%20%28%21menupopup.hasAttribute%28%22onclick%22%29%20%26%26%0A%20%20%20%20%20%20%28menupopup.id%20%21%3D%20%22stylish-popup%22%29%29%20%7B%0A%20%20%20%20menupopup.setAttribute%28%22onclick%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22if%20%28event.button%20%3D%3D%202%29%20%7B%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20event.preventDefault%28%29%3B%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20event.stopPropagation%28%29%3B%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20inspectDOMNode%28event.target%29%3B%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20closeMenus%28this%29%3B%20%7D%22%29%3B%0A%20%20%7D%0A%20%20if%20%28%28menupopup.parentNode%20%3D%3D%20popupset%29%20%26%26%0A%20%20%20%20%20%20%28menupopup.id%20%21%3D%20%22stylish-style-context%22%29%29%20%7B%0A%20%20%20%20addInspector%28menupopup%2C%20id%20+%20menupopup.id%2C%20this.image%29%3B%0A%20%20%7D%0A%7D%0A%0AremoveNode%28%22inspect-context%22%29%3B%0Apopupset.appendChild%28cbu.makeXML%28%3Cmenupopup%20id%3D%22inspect-context%22%20xmlns%3D%7Bxulns%7D%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3Cmenuitem%20id%3D%22inspect-chrome%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20class%3D%22menuitem-iconic%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20image%3D%7Bthis.image%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20label%3D%22Inspect%20Element%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20oncommand%3D%22inspectDOMNode%28document.popupNode%29%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20onclick%3D%22if%20%28event.button%20%3D%3D%201%29%20%7B%20inspectObject%28document.popupNode%29%3B%20closeMenus%28this%29%3B%20%7D%22%20/%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3C/menupopup%3E%29%29%3B%0Adocument.getElementById%28%22main-window%22%29%0A%20%20%20%20%20%20%20%20.setAttribute%28%22context%22%2C%20%22inspect-context%22%29%3B%0A%0A%0A//--------------------%20For%20Firefox%20prior%20to%20version%204%20--------------------%0A%0Avar%20popups%20%3D%20popupset.getElementsByTagName%28%22popup%22%29%3B%0Afor%20%28var%20j%20%3D%200%3B%20j%20%3C%20popups.length%3B%20j++%29%20%7B%0A%20%20let%20popup%20%3D%20popups%5Bj%5D%3B%0A%20%20if%20%28%21popup.hasAttribute%28%22onclick%22%29%29%20%7B%0A%20%20%20%20popup.setAttribute%28%22onclick%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22if%20%28event.button%20%3D%3D%202%29%20%7B%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20event.preventDefault%28%29%3B%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20event.stopPropagation%28%29%3B%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20inspectDOMNode%28event.target%29%3B%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%20closeMenus%28this%29%3B%20%7D%22%29%3B%0A%20%20%7D%0A%20%20if%20%28popup.parentNode%20%3D%3D%20popupset%29%20%7B%0A%20%20%20%20addInspector%28popup%2C%20id%20+%20popup.id%2C%20this.image%29%3B%0A%20%20%7D%0A%7D%0A%0A//%20Tab%20contextmenu%0Avar%20tabContext%20%3D%20document.getAnonymousElementByAttribute%28%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20gBrowser%2C%20%22anonid%22%2C%20%22tabContextMenu%22%29%3B%0Aif%20%28tabContext%29%20%7B%0A%20%20addInspector%28tabContext%2C%20id%20+%20%22tabContextMenu%22%2C%20this.image%29%3B%0A%7D%0A%0A//------------------------------------------------------------------------%0A%0A%5D%5D%3E%3C/initcode%3E%0A%20%20%3Ccode%3E%3C%21%5BCDATA%5B/*%20----------------------------------------------------------------%0A%20%20%20%20%20DOM%20Inspector%0A%0A%20%20%20%20%20Idea%20for%20this%20button%20was%20taken%20from%0A%20%20%20%20%20InspectorWidget%20extension%20by%20Sailfish%0A%20%20%20%20%20https%3A//addons.mozilla.org/firefox/63/%0A%20%20%20----------------------------------------------------------------%20*/%0A%0Athis.inspectWin%28%29%3B%5D%5D%3E%3C/code%3E%0A%20%20%3Caccelkey%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/accelkey%3E%0A%20%20%3Chelp%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/help%3E%0A%20%20%3Cattributes/%3E%0A%3C/custombutton%3E" title="DOM Inspector">
        <![CDATA[Install this button]]>
        </html:a>
      </html:div>
      <html:a href="https://addons.mozilla.org/addon/custom-buttons/">
        <![CDATA[What's this?]]>
      </html:a>
      <html:div id="credits">
        <html:a href="http://custombuttons.mozdev.org/drupal/node/484">
          <![CDATA[Custom Buttons XML]]><html:br/><![CDATA[Exporter/Importer]]>
        </html:a>
      </html:div>
    </html:div>
  </html:body>

  <name>DOM Inspector</name>
  <image><![CDATA[data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAB3RJTUUH1QgECxw1jaSNNQAAAAlwSFlzAAAK8AAACvABQqw0mAAAADBQTFRFAAAA/wAA/20A/4UA/60AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwJ3q+AAAAEFJREFUeNpjYIABFhcwcAAxGBggDAYlJQYwg0lJSQHEcFACAhZ0hhEKA6jYWACunQVqoAODA9QKuF0OcEvhjmAAAOEEEW5k07z8AAAAAElFTkSuQmCC]]></image>
  <mode>0</mode>
  <initcode><![CDATA[
// Check if DOM Inspector is installed and enabled
if (typeof inspectDOMDocument != "function") {
  this.tooltipText = "DOM Inspector extension is not installed or is disabled.";
  this.disabled = true;
  return;
}

// Append menuitems
function addItem(aNode, aLabel, aKey, aStatus, aValue) {
  aNode.appendChild(cbu.makeXML(<menuitem xmlns={xulns}
                                label={aLabel} statustext={aStatus}
                                accesskey={aKey} value={aValue}
                                context="toolbar-context-menu"
                                oncommand="this.parentNode.parentNode.inspectWin(event);"
                                onmouseover="this.parentNode.parentNode.setStatus(this.statusText);"
                                onmouseout="this.parentNode.parentNode.setStatus('');"/>));
}

// Enumerate open windows
function getWindowEnumerator() {
  return Components.classes["@mozilla.org/embedcomp/window-watcher;1"]
                   .getService(Components.interfaces.nsIWindowWatcher)
                   .getWindowEnumerator();
}

// Display window URL on statusbar
this.setStatus = function(aString) {
  document.getElementById("statusbar-display").label = aString;
}

// Regenerate menuitems
this.popupShowing = function(aNode) {
  while (aNode.lastChild) {
    aNode.removeChild(aNode.lastChild);
  }
  var index = 1;
  var enumerator = getWindowEnumerator();
  while (enumerator.hasMoreElements()) {
    let win = enumerator.getNext();
    addItem(aNode, index + " " + win.document.title,
            index, win.location, index++);
  }
}

// Inspect document/window
this.inspectWin = function(aEvent) {
  if (aEvent) {
    if (aEvent.target.nodeName != "toolbarbutton") {
      var windowIndex = parseInt(aEvent.target.getAttribute("value"));
      var enumerator = getWindowEnumerator();
      var index = 1;
      while (enumerator.hasMoreElements()) {
        let win = enumerator.getNext();
        if (index++ == windowIndex) {
          inspectDOMDocument(win.document);
          return;
        }
      }
    }
  } else {
    // Inspect document in active tab
    inspectDOMDocument(content.document);
  }
}

// Middle click to inspect chrome instead of content
this.setAttribute("onclick", "if (event.button == 1) inspectDOMDocument(document.documentElement);");

this.appendChild(cbu.makeXML(<menupopup
                     xmlns={xulns}
                     oncommand="event.stopPropagation();"
                     onpopupshowing="this.parentNode.popupShowing(this);"/>));

this.type = "menu-button";


//------------------------- Add "Inspect Element" -------------------------

// Remove element if it exists
function removeNode(aId) {
  var node = document.getElementById(aId);
  if (node) {
    node.parentNode.removeChild(node);
  }
}

// Append menuitem into a menupopup
function addInspector(aMenupopup, aId, aImage) {
  // Remove previously created menuitem
  // to avoid duplicate during button initiation
  removeNode(aId);

  // Create a new one
  aMenupopup.appendChild(cbu.makeXML(<menuitem
                                      xmlns={xulns} id={aId}
                                      class="menuitem-iconic"
                                      image={aImage}
                                      label="Inspect Element"
                                      oncommand="inspectDOMNode(document.popupNode);"
                                      onclick="if (event.button == 1) { inspectObject(document.popupNode); closeMenus(this); }" />));
}

var id = "inspector-";
var popupset = document.getElementById("mainPopupSet");

var menupopups = popupset.getElementsByTagName("menupopup");
for (var i = 0; i < menupopups.length; i++) {
  let menupopup = menupopups[i];
  if (!menupopup.hasAttribute("onclick") &&
      (menupopup.id != "stylish-popup")) {
    menupopup.setAttribute("onclick",
                           "if (event.button == 2) {" +
                           " event.preventDefault();" +
                           " event.stopPropagation();" +
                           " inspectDOMNode(event.target);" +
                           " closeMenus(this); }");
  }
  if ((menupopup.parentNode == popupset) &&
      (menupopup.id != "stylish-style-context")) {
    addInspector(menupopup, id + menupopup.id, this.image);
  }
}

removeNode("inspect-context");
popupset.appendChild(cbu.makeXML(<menupopup id="inspect-context" xmlns={xulns}>
                                  <menuitem id="inspect-chrome"
                                            class="menuitem-iconic"
                                            image={this.image}
                                            label="Inspect Element"
                                            oncommand="inspectDOMNode(document.popupNode)"
                                            onclick="if (event.button == 1) { inspectObject(document.popupNode); closeMenus(this); }" />
                                 </menupopup>));
document.getElementById("main-window")
        .setAttribute("context", "inspect-context");


//-------------------- For Firefox prior to version 4 --------------------

var popups = popupset.getElementsByTagName("popup");
for (var j = 0; j < popups.length; j++) {
  let popup = popups[j];
  if (!popup.hasAttribute("onclick")) {
    popup.setAttribute("onclick",
                       "if (event.button == 2) {" +
                       " event.preventDefault();" +
                       " event.stopPropagation();" +
                       " inspectDOMNode(event.target);" +
                       " closeMenus(this); }");
  }
  if (popup.parentNode == popupset) {
    addInspector(popup, id + popup.id, this.image);
  }
}

// Tab contextmenu
var tabContext = document.getAnonymousElementByAttribute(
                    gBrowser, "anonid", "tabContextMenu");
if (tabContext) {
  addInspector(tabContext, id + "tabContextMenu", this.image);
}

//------------------------------------------------------------------------

]]></initcode>
  <code><![CDATA[/* ----------------------------------------------------------------
     DOM Inspector

     Idea for this button was taken from
     InspectorWidget extension by Sailfish
     https://addons.mozilla.org/firefox/63/
   ---------------------------------------------------------------- */

this.inspectWin();]]></code>
  <accelkey><![CDATA[]]></accelkey>
  <help><![CDATA[]]></help>
  <attributes/>
</custombutton>