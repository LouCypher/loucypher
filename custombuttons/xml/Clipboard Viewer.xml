<?xml version="1.0" encoding="UTF-8"?>
<custombutton xmlns:cb="http://xsms.nm.ru/custombuttons/"
              xmlns:html="http://www.w3.org/1999/xhtml">
  <html:head>
    <html:title><![CDATA[Clipboard Viewer]]></html:title>
    <html:link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAArdJREFUeNpsU11IU2EYfs/Zt+Vy7sfKEZEp2pxmF2uKUVhq2VKwTB0FmT8FCUbgpTddBWFBICJRgVleRC5GUeRNpPZj+bfMrJZhajeWRTPa2mTnr/c77Iyj9cLD2fd97/PsOc/7HQawytMQW0AuhoF49a+rzmQYZp+yliTpSclP74yybh6QgHTuhdV1DeGkP6zPvNAyNONUDtp3Z/pgW7zPh2hiRQlADUEE5373SafVnu888eCtUxBYMBiMQJ90TffpOe2jKoQX/nEAtuYumOjthZHRp2A0GsGQmAgcx0EwGIQNpa1gq6qCR7dvyL1E+I9AKBKBEpcLvi0sANFoQMOywCJopaWno1MJFB6J8iu4DA3x+9ISrDebIctmkzcpQRRFWYRHJouinCLA8Wo2FG+0O/TJJhPf4/WOdns8U5i8VFdTk9vgdheggpbFJoLgYzyCYajrWPHZtk2evr6Rx2P+F1cvX8+gmxeudL7UaO+LtZWVeyLoQK9ywFIHKmRt3r7T8LC/f+xIZUPq5x98AkXt0VMZjwYHx3FIEF5eBh5fR3G+OgOgTSaLhUvS60hOqnkN3fsaCILRYokKSPyDAScmJYHCW+1gen5iOOQuK8t///GVP4FI4lotML6pockql2tHMByGZRyngKHGHYTCqIIT0hI5xPEv/g+HDzSeKdTqXgudd3ue0xALHY5d+dnZJfM41hSrFTSEwK9gTIDePpaRBSoKqutbXadbUu51tC+mZufkna+rK6JN/pHh0MXy0k+zkxMR5VXxT32ygDxnERodh+rPHb90M72rpWGur/tWW+A35OFRVqx/GnFHw8IAQooTaeXqAWpMME6tdjTVzxYZoMKuwxsHK2FWBZ2MjrcS+esE8g5D1fHgPahjYBHA84aDOeyxI6IILvaMqtZ8AC9mIBbiXwEGADy0Lb/f2n5rAAAAAElFTkSuQmCC"/>
    <html:style type="text/css"><![CDATA[body { font-size: medium; margin: 0; }
body, code:before, help:before, initcode:before {
  font-family: "Verdana", sans-serif;
} 
#wrapper { position: fixed; top: 1em; right: 1em; text-align: center; }
p { font-size: small; text-align: center; }
#button {
  background-image: -moz-linear-gradient(center top, rgb(147, 200, 94) 30%, rgb(85, 168, 2) 55%);
  border: 1px outset rgb(58, 116, 4);
  border-radius: 1em;
  padding: 0;
  text-shadow: 0pt -1px 0pt rgb(58, 116, 4);
  margin-bottom: 1em;
}
#button a {
  color: rgb(255, 255, 255);
  padding: 1em;
  text-decoration: none;
}
#button a, code, code:before, initcode, initcode:before, help, help:before {
  display: block;
}
#credits { position: fixed; bottom: 1em; right: 1em; font-size: small; }
custombutton { background-color: rgb(171, 171, 171); margin: 1em; }
image, mode, accelkey { display: none; }
name { font-weight: bold; font-size: x-large; }
code:before, help:before, initcode:before {
  font-weight: bold;
  font-size: large;
  margin: 0 0 1em;
  padding: .5em;
}
code:before { content: "CODE"; }
help:before { content: "Help"; }
initcode:before { content: "Initialization Code"; }
code, initcode, help {
  background-color: rgb(255, 255, 255);
  border: 1px inset rgb(170, 170, 170);
  font: medium monospace;
  margin: 1em 1em 2em 0;
  padding: 1em;
  text-align: left;
  width: 840px;
  white-space: pre-wrap;
  word-wrap: break-word;
}
.clear { clear: both; }
]]></html:style>
  </html:head>
  <html:body>
    <html:div id="wrapper">
      <html:div id="button">
        <html:a href="custombutton://%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0D%0A%3Ccustombutton%20xmlns%3Acb%3D%22http%3A//xsms.nm.ru/custombuttons/%22%3E%0A%20%20%3Cname%3EClipboard%20Viewer%3C/name%3E%0A%20%20%3Cimage%3E%3C%21%5BCDATA%5Bdata%3Aimage/png%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAArdJREFUeNpsU11IU2EYfs/Zt+Vy7sfKEZEp2pxmF2uKUVhq2VKwTB0FmT8FCUbgpTddBWFBICJRgVleRC5GUeRNpPZj+bfMrJZhajeWRTPa2mTnr/c77Iyj9cLD2fd97/PsOc/7HQawytMQW0AuhoF49a+rzmQYZp+yliTpSclP74yybh6QgHTuhdV1DeGkP6zPvNAyNONUDtp3Z/pgW7zPh2hiRQlADUEE5373SafVnu888eCtUxBYMBiMQJ90TffpOe2jKoQX/nEAtuYumOjthZHRp2A0GsGQmAgcx0EwGIQNpa1gq6qCR7dvyL1E+I9AKBKBEpcLvi0sANFoQMOywCJopaWno1MJFB6J8iu4DA3x+9ISrDebIctmkzcpQRRFWYRHJouinCLA8Wo2FG+0O/TJJhPf4/WOdns8U5i8VFdTk9vgdheggpbFJoLgYzyCYajrWPHZtk2evr6Rx2P+F1cvX8+gmxeudL7UaO+LtZWVeyLoQK9ywFIHKmRt3r7T8LC/f+xIZUPq5x98AkXt0VMZjwYHx3FIEF5eBh5fR3G+OgOgTSaLhUvS60hOqnkN3fsaCILRYokKSPyDAScmJYHCW+1gen5iOOQuK8t///GVP4FI4lotML6pockql2tHMByGZRyngKHGHYTCqIIT0hI5xPEv/g+HDzSeKdTqXgudd3ue0xALHY5d+dnZJfM41hSrFTSEwK9gTIDePpaRBSoKqutbXadbUu51tC+mZufkna+rK6JN/pHh0MXy0k+zkxMR5VXxT32ygDxnERodh+rPHb90M72rpWGur/tWW+A35OFRVqx/GnFHw8IAQooTaeXqAWpMME6tdjTVzxYZoMKuwxsHK2FWBZ2MjrcS+esE8g5D1fHgPahjYBHA84aDOeyxI6IILvaMqtZ8AC9mIBbiXwEGADy0Lb/f2n5rAAAAAElFTkSuQmCC%5D%5D%3E%3C/image%3E%0A%20%20%3Cmode%3E0%3C/mode%3E%0A%20%20%3Cinitcode%3E%3C%21%5BCDATA%5BgCBClipboardViewer%20%3D%20this%3B%20//%20global%20obj%0Athis.toString%20%3D%20function%20toString%28%29%20%7Breturn%20this.name%3B%7D%0A%0A//this.xurl%20%3D%20%22chrome%3A//chromedir/content/clipboard-viewer.xul%22%3B%0Athis.xurl%20%3D%20%22data%3Aapplication/vnd.mozilla.xul+xml%3Bbase64%2C%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20encodeURIComponent%28btoa%28this.Help%29%29%3B%0A%0Athis.panel%20%3D%20false%3B%0A%0Athis.onclick%20%3D%20function%28aEvent%29%20%7B%0A%20%20if%20%28aEvent.button%20%3D%3D%201%29%20%7B%20//%20Middle%20click%0A%20%20%20%20this.togglePanel%28%29%3B%20%20%20%20%20//%20open%20in%20bottom%20panel%0A%20%20%7D%0A%0A%20%20else%20if%20%28aEvent.shiftKey%29%20%7B%20%20%20//%20Shift+left-click%0A%20%20%20%20aEvent.preventDefault%28%29%3B%0A%20%20%20%20this.toggleSidebar%28%29%3B%20%20%20%20%20%20%20//%20open%20in%20sidebar%0A%20%20%7D%0A%0A//%20This%20won%27t%20work%20for%20data%3AURI%20XUL%20on%20Firefox%204%0A%20%20else%20if%20%28%28aEvent.ctrlKey%20%20%7C%7C%20aEvent.metaKey%29%20%26%26%20//%20if%20Ctrl+left-click%0A%20%20%20%20%20%20%20%20%20%20%20%28%28Application.version%20%3C%20%224.0%22%29%20%7C%7C%20%20//%20if%20Firefox%20prior%20to%20version%204%0A%20%20%20%20%20%20%20%20%20%20%20%20%28/%5Echrome%5C%3A/.test%28this.xurl%29%29%29%29%20%7B%20%20%20%20%20//%20if%20chrome%20URL%0A%20%20%20%20aEvent.preventDefault%28%29%3B%0A%20%20%20%20var%20tabs%20%3D%20gBrowser.mTabs%3B%0A%20%20%20%20for%20%28var%20i%20%3D%200%3B%20i%20%3C%20tabs.length%3B%20i++%29%20%7B%0A%20%20%20%20%20%20if%20%28tabs%5Bi%5D.linkedBrowser.currentURI.spec%20%3D%3D%20this.xurl%29%20%7B%0A%20%20%20%20%20%20%20%20gBrowser.selectedTab%20%3D%20tabs%5Bi%5D%3B%0A%20%20%20%20%20%20%20%20return%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20gBrowser.loadOneTab%28this.xurl%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20//%20open%20in%20new%20tab%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20null%2C%20null%2C%20null%2C%20false%29%3B%0A%20%20%7D%0A%7D%0A%0Afunction%20%24%28aId%29%20%7B%0A%20%20return%20document.getElementById%28aId%29%3B%0A%7D%0A%0Athis.togglePanel%20%3D%20function%28%29%20%7B%0A%20%20this.panel%20%3D%20%21this.panel%3B%0A%20%20%24%28this.id%20+%20%22-splitter%22%29.hidden%20%3D%20%21this.panel%3B%0A%20%20%24%28this.id%20+%20%22-panel%22%29.hidden%20%3D%20%21this.panel%3B%0A%20%20%24%28this.id%20+%20%22-iframe%22%29.setAttribute%28%22src%22%2C%20this.panel%20%3F%20this.xurl%20%3A%20%22%22%29%3B%0A%7D%0A%0Athis.toggleSidebar%20%3D%20function%28%29%20%7B%0A%20%20toggleSidebar%28this.id%20+%20%22-sidebar%22%29%3B%0A%7D%0A%0Afunction%20%24xml%28aNode%2C%20aId%2C%20aXML%29%20%7B%0A%20%20var%20node%20%3D%20%24%28aId%29%3B%0A%20%20if%20%28node%29%20node.parentNode.removeChild%28node%29%3B%0A%20%20aNode.appendChild%28cbu.makeXML%28aXML%29%29%0A%7D%0A%0A%24xml%28%24%28%22mainBroadcasterSet%22%29%2C%0A%20%20%20%20%20%20%20this.id%20+%20%22-sidebar%22%2C%0A%20%20%20%20%20%20%20%20%3Cbroadcaster%20xmlns%3D%7Bxulns%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20id%3D%7Bthis.id%20+%20%22-sidebar%22%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20label%3D%7Bthis.label%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20sidebartitle%3D%7Bthis.label%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20sidebarurl%3D%7Bthis.xurl%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%3D%22checkbox%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20autoCheck%3D%22false%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20group%3D%22sidebar%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20oncommand%3D%22gCBClipboardViewer.toggleSidebar%28%29%3B%22%20/%3E%29%3B%0A%0A%24xml%28%24%28%22viewSidebarMenu%22%29%2C%0A%20%20%20%20%20%20%20this.id%20+%20%22-viewsidebar%22%2C%0A%20%20%20%20%20%20%20%3Cmenuitem%20xmlns%3D%7Bxulns%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20id%3D%7Bthis.id%20+%20%22-viewsidebar%22%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20observes%3D%7Bthis.id%20+%20%22-sidebar%22%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20label%3D%7Bthis.label%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20sidebartitle%3D%7Bthis.label%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20sidebarurl%3D%7Bthis.xurl%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20type%3D%22checkbox%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20autoCheck%3D%22false%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20group%3D%22sidebar%22%20/%3E%29%3B%0A%0A%24xml%28%24%28%22appcontent%22%29%2C%0A%20%20%20%20%20%20%20this.id%20+%20%22-splitter%22%2C%0A%20%20%20%20%20%20%20%3Csplitter%20xmlns%3D%7Bxulns%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20id%3D%7Bthis.id%20+%20%22-splitter%22%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20orient%3D%22vertical%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20hidden%3D%22true%22%3E%0A%20%20%20%20%20%20%20%20%20%3Cgrippy%20oncommand%3D%7B%22this.parentNode.nextSibling.collapsed%20%3D%20%22%20+%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%21this.parentNode.nextSibling.collapsed%3B%22%7D/%3E%0A%20%20%20%20%20%20%20%3C/splitter%3E%29%3B%0A%0A%24xml%28%24%28%22appcontent%22%29%2C%0A%20%20%20%20%20%20%20this.id%20+%20%22-panel%22%2C%0A%20%20%20%20%20%20%20%3Cvbox%20xmlns%3D%7Bxulns%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20id%3D%7Bthis.id%20+%20%22-panel%22%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20height%3D%22300%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20hidden%3D%22true%22%3E%0A%20%20%20%20%20%20%20%20%20%3Ctoolbox%3E%0A%20%20%20%20%20%20%20%20%20%20%20%3Ctoolbar%20align%3D%22center%22%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%3Clabel%20value%3D%7Bthis.label%7D%20flex%3D%221%22%20crop%3D%22end%22%20/%3E%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%3Ctoolbarbutton%20class%3D%22tabs-closebutton%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20oncommand%3D%22gCBClipboardViewer.togglePanel%28%29%3B%22%20/%3E%0A%20%20%20%20%20%20%20%20%20%20%20%3C/toolbar%3E%0A%20%20%20%20%20%20%20%20%20%3C/toolbox%3E%0A%20%20%20%20%20%20%20%20%20%3Ciframe%20id%3D%7Bthis.id%20+%20%22-iframe%22%7D%20src%3D%22%22%20flex%3D%221%22%20/%3E%0A%20%20%20%20%20%20%20%3C/vbox%3E%29%3B%0A%0Athis.tooltipText%20%3D%20%22%5Cn%5C%0ALeft-click%3A%20open%20in%20new%20window%5Cn%5Cn%5C%0AMiddle-click%3A%20open%20in%20bottom%20panel%5Cn%5Cn%5C%0AShift+click%3A%20open%20in%20sidebar%5Cn%5Cn%5C%0ACtrl+click%3A%20open%20in%20new%20tab%5Cn%5C%0A%28for%20Firefox%20prior%20to%20version%204%20only%29%5Cn%5Cn%22%3B%0A%0A%5D%5D%3E%3C/initcode%3E%0A%20%20%3Ccode%3E%3C%21%5BCDATA%5Bvar%20ww%20%3D%20Components.classes%5B%22@mozilla.org/embedcomp/window-watcher%3B1%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.getService%28Components.interfaces.nsIWindowWatcher%29%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0Avar%20em%20%3D%20ww.getWindowEnumerator%28%29%3B%0A%0Avar%20winName%20%3D%20%22clipview%22%3B%0A%0Avar%20index%20%3D%201%3B%0Awhile%20%28em.hasMoreElements%28%29%29%20%7B%0A%20%20let%20win%20%3D%20em.getNext%28%29%3B%0A%20%20if%28win.name%20%3D%3D%20winName%29%20%7B%0A%20%20%20%20win.focus%28%29%3B%0A%20%20%20%20return%3B%0A%20%20%7D%0A%20%20index++%0A%7D%0A%0AopenDialog%28this.xurl%2C%20winName%2C%20%22chrome%2C%20dialog%3Dno%2C%20centerscreen%2C%20minimizable%2C%20resizable%22%29%3B%0A%0A%5D%5D%3E%3C/code%3E%0A%20%20%3Caccelkey%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/accelkey%3E%0A%20%20%3Chelp%3E%26lt%3B%3Fxml%20version%3D%221.0%22%3F%26gt%3B%0A%26lt%3B%21--%0A%20%20Version%3A%20MPL%201.1/GPL%202.0/LGPL%202.1%0A%0A%20%20The%20contents%20of%20this%20file%20are%20subject%20to%20the%20Mozilla%20Public%20License%20Version%0A%20%201.1%20%28the%20%22License%22%29%3B%20you%20may%20not%20use%20this%20file%20except%20in%20compliance%20with%0A%20%20the%20License.%20You%20may%20obtain%20a%20copy%20of%20the%20License%20at%0A%20%20http%3A//www.mozilla.org/MPL/%0A%0A%20%20Software%20distributed%20under%20the%20License%20is%20distributed%20on%20an%20%22AS%20IS%22%20basis%2C%0A%20%20WITHOUT%20WARRANTY%20OF%20ANY%20KIND%2C%20either%20express%20or%20implied.%20See%20the%20License%0A%20%20for%20the%20specific%20language%20governing%20rights%20and%20limitations%20under%20the%0A%20%20License.%0A%0A%20%20The%20Original%20Code%20is%20Clipboard%20Viewer%0A%0A%20%20The%20Initial%20Developer%20of%20the%20Original%20Code%20is%20LouCypher.%0A%20%20Portions%20created%20by%20the%20Initial%20Developer%20are%20Copyright%20%28C%29%202011%0A%20%20the%20Initial%20Developer.%20All%20Rights%20Reserved.%0A%0A%20%20Contributor%28s%29%3A%0A%20%20-%20LouCypher%20%26lt%3Bloucypher@mozillaca.com%26gt%3B%0A%0A%20%20Alternatively%2C%20the%20contents%20of%20this%20file%20may%20be%20used%20under%20the%20terms%20of%0A%20%20either%20the%20GNU%20General%20Public%20License%20Version%202%20or%20later%20%28the%20%22GPL%22%29%2C%20or%0A%20%20the%20GNU%20Lesser%20General%20Public%20License%20Version%202.1%20or%20later%20%28the%20%22LGPL%22%29%2C%0A%20%20in%20which%20case%20the%20provisions%20of%20the%20GPL%20or%20the%20LGPL%20are%20applicable%20instead%0A%20%20of%20those%20above.%20If%20you%20wish%20to%20allow%20use%20of%20your%20version%20of%20this%20file%20only%0A%20%20under%20the%20terms%20of%20either%20the%20GPL%20or%20the%20LGPL%2C%20and%20not%20to%20allow%20others%20to%0A%20%20use%20your%20version%20of%20this%20file%20under%20the%20terms%20of%20the%20MPL%2C%20indicate%20your%0A%20%20decision%20by%20deleting%20the%20provisions%20above%20and%20replace%20them%20with%20the%20notice%0A%20%20and%20other%20provisions%20required%20by%20the%20GPL%20or%20the%20LGPL.%20If%20you%20do%20not%20delete%0A%20%20the%20provisions%20above%2C%20a%20recipient%20may%20use%20your%20version%20of%20this%20file%20under%0A%20%20the%20terms%20of%20any%20one%20of%20the%20MPL%2C%20the%20GPL%20or%20the%20LGPL.%0A--%26gt%3B%0A%0A%26lt%3B%3Fxml-stylesheet%20type%3D%22text/css%22%20href%3D%22chrome%3A//global/skin/%22%3F%26gt%3B%0A%26lt%3B%3Fxml-stylesheet%20type%3D%22text/css%22%20href%3D%22clipboard-viewer.css%22%3F%26gt%3B%0A%0A%26lt%3Bdialog%20xmlns%3D%22http%3A//www.mozilla.org/keymaster/gatekeeper/there.is.only.xul%22%0A%20%20%20%20%20%20%20%20xmlns%3Ahtml%3D%22http%3A//www.w3.org/1999/xhtml%22%0A%20%20%20%20%20%20%20%20id%3D%22clipboard-viewer%22%0A%20%20%20%20%20%20%20%20width%3D%22800%22%0A%20%20%20%20%20%20%20%20height%3D%22600%22%0A%20%20%20%20%20%20%20%20title%3D%22Clipboard%20Viewer%22%0A%20%20%20%20%20%20%20%20buttons%3D%22extra1%2C%20extra2%2C%20cancel%22%0A%20%20%20%20%20%20%20%20buttonlabelextra1%3D%22Edit%22%0A%20%20%20%20%20%20%20%20buttonlabelextra2%3D%22Clear%22%0A%20%20%20%20%20%20%20%20buttonlabelcancel%3D%22Close%22%0A%20%20%20%20%20%20%20%20buttonaccesskeyextra1%3D%22E%22%0A%20%20%20%20%20%20%20%20buttonaccesskeyextra2%3D%22r%22%0A%20%20%20%20%20%20%20%20buttonaccesskeycancel%3D%22C%22%0A%20%20%20%20%20%20%20%20ondialogextra1%3D%22toggleEdit%28%29%3B%22%0A%20%20%20%20%20%20%20%20ondialogextra2%3D%22clearClipboard%28%29%3B%22%0A%20%20%20%20%20%20%20%20ondialogcancel%3D%22closeDialog%28%29%3B%22%0A%20%20%20%20%20%20%20%20onfocus%3D%22loadFromClipboard%28%29%3B%22%26gt%3B%0A%0A%20%20%26lt%3Bhtml%3Ahead%26gt%3B%0A%20%20%20%20%26lt%3Bhtml%3Alink%20rel%3D%22shortcut%20icon%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20href%3D%22chrome%3A//chromedir/content/clipboard-viewer.png%22%20/%26gt%3B%0A%20%20%26lt%3B/html%3Ahead%26gt%3B%0A%0A%20%20%26lt%3Bkeyset%26gt%3B%26lt%3Bkey%20keycode%3D%22VK_F5%22%20oncommand%3D%22loadFromClipboard%28%29%3B%22%20/%26gt%3B%26lt%3B/keyset%26gt%3B%0A%0A%20%20%26lt%3Bpopupset%26gt%3B%0A%20%20%20%20%26lt%3Bmenupopup%20id%3D%22contextmenu%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20onpopupshowing%3D%22popupShowing%28event%29%3B%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20onpopuphiding%3D%22loadFromClipboard%28%29%3B%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20oncommand%3D%22var%20cmd%20%3D%20event.originalTarget.getAttribute%28%27cmd%27%29%3B%0A%20if%20%28cmd%29%20document.popupNode.parentNode.doCommand%28cmd%29%3B%22%26gt%3B%0A%20%20%20%20%20%20%26lt%3Bmenuitem%20id%3D%22edit-copy%22%20label%3D%22Copy%22%20accesskey%3D%22c%22%20cmd%3D%22cmd_copy%22%20/%26gt%3B%0A%20%20%20%20%20%20%26lt%3B%21--menuitem%20id%3D%22edit-delete%22%20label%3D%22Delete%22%20accesskey%3D%22d%22%20cmd%3D%22cmd_delete%22%20/--%26gt%3B%0A%20%20%20%20%20%20%26lt%3Bmenuseparator%20/%26gt%3B%0A%20%20%20%20%20%20%26lt%3Bmenuitem%20id%3D%22edit-selectAll%22%20label%3D%22Select%20All%22%20accesskey%3D%22a%22%20cmd%3D%22cmd_selectAll%22%20/%26gt%3B%0A%20%20%20%20%26lt%3B/menupopup%26gt%3B%0A%20%20%26lt%3B/popupset%26gt%3B%0A%0A%20%20%26lt%3Btextbox%20id%3D%22textbox%22%20multiline%3D%22true%22%20flex%3D%221%22%0A%20%20%20%20%20%20%20%20%20%20%20context%3D%22contextmenu%22%20onkeyup%3D%22copyToClipboard%28%29%3B%22%20readonly%3D%22%22%20/%26gt%3B%0A%0A%20%20%26lt%3Bscript%20type%3D%22application/x-javascript%22%26gt%3B%26lt%3B%21%5BCDATA%5B%0Aconst%20Cc%20%3D%20Components.classes%3B%0Aconst%20Ci%20%3D%20Components.interfaces%3B%0A%0Aconst%20gTextbox%20%3D%20document.getElementById%28%22textbox%22%29%3B%0A%0Aconst%20clipboardHelper%20%3D%20Cc%5B%22@mozilla.org/widget/clipboardhelper%3B1%22%5D.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20getService%28Ci.nsIClipboardHelper%29%3B%0A%0Afunction%20getMainwin%28%29%20%7B%0A%20%20if%20%28window.frameElement%29%20%7B%0A%20%20%20%20return%20window.frameElement.ownerDocument.defaultView%3B%0A%0A%20%20%7D%20else%20if%20%28window.opener%29%20%7B%0A%20%20%20%20return%20window.opener%3B%0A%0A%20%20%7D%20else%20%7B%0A%20%20%20%20return%20Cc%5B%27@mozilla.org/appshell/window-mediator%3B1%27%5D.%0A%20%20%20%20%20%20%20%20%20%20%20getService%28%29.QueryInterface%28Ci.nsIWindowMediator%29.%0A%20%20%20%20%20%20%20%20%20%20%20getMostRecentWindow%28%22navigator%3Abrowser%22%29%0A%20%20%7D%0A%7D%0A%0Afunction%20readFromClipboard%28%29%20%7B%0A//http%3A//mxr.mozilla.org/mozilla2.0/source/browser/base/content/browser.js%232299%0A%20%20var%20string%3B%0A%20%20try%20%7B%0A%20%20%20%20%20%20var%20clipboard%20%3D%20Cc%5B%22@mozilla.org/widget/clipboard%3B1%22%5D.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20getService%28Ci.nsIClipboard%29%3B%0A%20%20%20%20%20%20var%20trans%20%3D%20Cc%5B%22@mozilla.org/widget/transferable%3B1%22%5D.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20createInstance%28Ci.nsITransferable%29%3B%0A%20%20%20%20%20%20trans.addDataFlavor%28%22text/unicode%22%29%3B%0A%20%20%20%20%20%20if%20%28clipboard.supportsSelectionClipboard%28%29%29%20%7B%0A%20%20%20%20%20%20%20%20clipboard.getData%28trans%2C%20clipboard.kSelectionClipboard%29%3B%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20clipboard.getData%28trans%2C%20clipboard.kGlobalClipboard%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20var%20data%20%3D%20%7B%7D%3B%0A%20%20%20%20%20%20var%20dataLen%20%3D%20%7B%7D%3B%0A%20%20%20%20%20%20trans.getTransferData%28%22text/unicode%22%2C%20data%2C%20dataLen%29%3B%0A%20%20%20%20%20%20if%20%28data%29%20%7B%0A%20%20%20%20%20%20%20%20data%20%3D%20data.value.QueryInterface%28Ci.nsISupportsString%29%3B%0A%20%20%20%20%20%20%20%20string%20%3D%20data.data.substring%280%2C%20dataLen.value%20/%202%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%7D%20catch%20%28ex%29%20%7B%0A%20%20%7D%0A%20%20return%20string%3B%0A%7D%0A%0Afunction%20loadFromClipboard%28%29%20%7B%0A%20%20var%20string%20%3D%20readFromClipboard%28%29%3B%0A%20%20if%20%28gTextbox.value%20%21%3D%20string%29%20%7B%0A%20%20%20%20if%20%28%21string%29%20%7B%0A%20%20%20%20%20%20gTextbox.value%20%3D%20%22%22%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20gTextbox.value%20%3D%20string%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A%0Afunction%20copyToClipboard%28%29%20%7B%0A%20%20clipboardHelper.copyString%28gTextbox.value%29%3B%0A%7D%0A%0Afunction%20clearClipboard%28%29%20%7B%0A%20%20clipboardHelper.copyString%28%22%22%29%3B%0A%20%20gTextbox.value%20%3D%20%22%22%3B%0A%7D%0A%0Afunction%20toggleEdit%28%29%20%7B%0A%20%20var%20button%20%3D%20document.documentElement.getButton%28%22extra1%22%29%3B%0A%20%20switch%28gTextbox.readOnly%29%20%7B%0A%20%20%20%20case%20true%3A%0A%20%20%20%20%20%20gTextbox.readOnly%20%3D%20false%3B%0A%20%20%20%20%20%20button.label%20%3D%20%22Lock%22%3B%0A%20%20%20%20%20%20button.accessKey%20%3D%20%22L%22%3B%0A%20%20%20%20%20%20break%3B%0A%20%20%20%20case%20false%3A%0A%20%20%20%20%20%20gTextbox.readOnly%20%3D%20true%3B%0A%20%20%20%20%20%20button.label%20%3D%20%22Edit%22%3B%0A%20%20%20%20%20%20button.accessKey%20%3D%20%22E%22%3B%0A%20%20%7D%0A%20%20gTextbox.focus%28%29%3B%0A%7D%0A%0Afunction%20closeDialog%28%29%20%7B%0A%20%20if%20%28window.frameElement%29%20%7B%0A%20%20%20%20switch%20%28window.frameElement.id%29%20%7B%0A%20%20%20%20case%20%22sidebar%22%3A%0A%20%20%20%20%20%20getMainwin%28%29.toggleSidebar%28%29%3B%0A%20%20%20%20%20%20break%3B%0A%20%20%20%20default%3A%0A%20%20%20%20%20%20getMainwin%28%29.gCBClipboardViewer.togglePanel%28%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%20else%20%7B%0A%20%20%20%20window.close%28%29%3B%0A%20%20%7D%0A%7D%0A%0Afunction%20popupShowing%28aEvent%29%20%7B%0A%20%20var%20children%20%3D%20aEvent.target.childNodes%3B%0A%20%20for%20%28var%20i%20%3D%200%3B%20i%20%26lt%3B%20children.length%3B%20i++%29%20%7B%0A%20%20%20%20var%20command%20%3D%20children%5Bi%5D.getAttribute%28%22cmd%22%29%3B%0A%20%20%20%20if%20%28command%29%20%7B%0A%20%20%20%20%20%20var%20controller%20%3D%20document.commandDispatcher%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.getControllerForCommand%28command%29%3B%0A%20%20%20%20%20%20var%20enabled%20%3D%20controller.isCommandEnabled%28command%29%3B%0A%20%20%20%20%20%20if%20%28enabled%29%20%7B%0A%20%20%20%20%20%20%20%20children%5Bi%5D.removeAttribute%28%22disabled%22%29%3B%0A%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20children%5Bi%5D.setAttribute%28%22disabled%22%2C%20%22true%22%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A%20%20%5D%5D%26gt%3B%26lt%3B/script%26gt%3B%0A%0A%26lt%3B/dialog%26gt%3B%3C/help%3E%0A%20%20%3Cattributes/%3E%0A%3C/custombutton%3E" rel="nofollow" title="Clipboard Viewer">
        <![CDATA[Install this button]]>
        </html:a>
      </html:div>
      <html:a href="https://addons.mozilla.org/addon/custom-buttons/">
        <![CDATA[What's this?]]>
      </html:a>
      <html:div id="credits">
        <html:a href="http://custombuttons.mozdev.org/drupal/node/484">
          <![CDATA[Custom Buttons XML]]><html:br/><![CDATA[Exporter/Importer]]>
        </html:a>
      </html:div>
    </html:div>
  </html:body>

  <name>Clipboard Viewer</name>
  <image><![CDATA[data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAArdJREFUeNpsU11IU2EYfs/Zt+Vy7sfKEZEp2pxmF2uKUVhq2VKwTB0FmT8FCUbgpTddBWFBICJRgVleRC5GUeRNpPZj+bfMrJZhajeWRTPa2mTnr/c77Iyj9cLD2fd97/PsOc/7HQawytMQW0AuhoF49a+rzmQYZp+yliTpSclP74yybh6QgHTuhdV1DeGkP6zPvNAyNONUDtp3Z/pgW7zPh2hiRQlADUEE5373SafVnu888eCtUxBYMBiMQJ90TffpOe2jKoQX/nEAtuYumOjthZHRp2A0GsGQmAgcx0EwGIQNpa1gq6qCR7dvyL1E+I9AKBKBEpcLvi0sANFoQMOywCJopaWno1MJFB6J8iu4DA3x+9ISrDebIctmkzcpQRRFWYRHJouinCLA8Wo2FG+0O/TJJhPf4/WOdns8U5i8VFdTk9vgdheggpbFJoLgYzyCYajrWPHZtk2evr6Rx2P+F1cvX8+gmxeudL7UaO+LtZWVeyLoQK9ywFIHKmRt3r7T8LC/f+xIZUPq5x98AkXt0VMZjwYHx3FIEF5eBh5fR3G+OgOgTSaLhUvS60hOqnkN3fsaCILRYokKSPyDAScmJYHCW+1gen5iOOQuK8t///GVP4FI4lotML6pockql2tHMByGZRyngKHGHYTCqIIT0hI5xPEv/g+HDzSeKdTqXgudd3ue0xALHY5d+dnZJfM41hSrFTSEwK9gTIDePpaRBSoKqutbXadbUu51tC+mZufkna+rK6JN/pHh0MXy0k+zkxMR5VXxT32ygDxnERodh+rPHb90M72rpWGur/tWW+A35OFRVqx/GnFHw8IAQooTaeXqAWpMME6tdjTVzxYZoMKuwxsHK2FWBZ2MjrcS+esE8g5D1fHgPahjYBHA84aDOeyxI6IILvaMqtZ8AC9mIBbiXwEGADy0Lb/f2n5rAAAAAElFTkSuQmCC]]></image>
  <mode>0</mode>
  <initcode><![CDATA[gCBClipboardViewer = this; // global obj
this.toString = function toString() {return this.name;}

//this.xurl = "chrome://chromedir/content/clipboard-viewer.xul";
this.xurl = "data:application/vnd.mozilla.xul+xml;base64," +
            encodeURIComponent(btoa(this.Help));

this.panel = false;

this.onclick = function(aEvent) {
  if (aEvent.button == 1) { // Middle click
    this.togglePanel();     // open in bottom panel
  }

  else if (aEvent.shiftKey) {   // Shift+left-click
    aEvent.preventDefault();
    this.toggleSidebar();       // open in sidebar
  }

// This won't work for data:URI XUL on Firefox 4
  else if ((aEvent.ctrlKey  || aEvent.metaKey) && // if Ctrl+left-click
           ((Application.version < "4.0") ||  // if Firefox prior to version 4
            (/^chrome\:/.test(this.xurl)))) {     // if chrome URL
    aEvent.preventDefault();
    var tabs = gBrowser.mTabs;
    for (var i = 0; i < tabs.length; i++) {
      if (tabs[i].linkedBrowser.currentURI.spec == this.xurl) {
        gBrowser.selectedTab = tabs[i];
        return;
      }
    }
    gBrowser.loadOneTab(this.xurl,                // open in new tab
                        null, null, null, false);
  }
}

function $(aId) {
  return document.getElementById(aId);
}

this.togglePanel = function() {
  this.panel = !this.panel;
  $(this.id + "-splitter").hidden = !this.panel;
  $(this.id + "-panel").hidden = !this.panel;
  $(this.id + "-iframe").setAttribute("src", this.panel ? this.xurl : "");
}

this.toggleSidebar = function() {
  toggleSidebar(this.id + "-sidebar");
}

function $xml(aNode, aId, aXML) {
  var node = $(aId);
  if (node) node.parentNode.removeChild(node);
  aNode.appendChild(cbu.makeXML(aXML))
}

$xml($("mainBroadcasterSet"),
       this.id + "-sidebar",
        <broadcaster xmlns={xulns}
                     id={this.id + "-sidebar"}
                     label={this.label}
                     sidebartitle={this.label}
                     sidebarurl={this.xurl}
                     type="checkbox"
                     autoCheck="false"
                     group="sidebar"
                     oncommand="gCBClipboardViewer.toggleSidebar();" />);

$xml($("viewSidebarMenu"),
       this.id + "-viewsidebar",
       <menuitem xmlns={xulns}
                 id={this.id + "-viewsidebar"}
                 observes={this.id + "-sidebar"}
                 label={this.label}
                 sidebartitle={this.label}
                 sidebarurl={this.xurl}
                 type="checkbox"
                 autoCheck="false"
                 group="sidebar" />);

$xml($("appcontent"),
       this.id + "-splitter",
       <splitter xmlns={xulns}
                 id={this.id + "-splitter"}
                 orient="vertical"
                 hidden="true">
         <grippy oncommand={"this.parentNode.nextSibling.collapsed = " +
                            "!this.parentNode.nextSibling.collapsed;"}/>
       </splitter>);

$xml($("appcontent"),
       this.id + "-panel",
       <vbox xmlns={xulns}
             id={this.id + "-panel"}
             height="300"
             hidden="true">
         <toolbox>
           <toolbar align="center">
             <label value={this.label} flex="1" crop="end" />
             <toolbarbutton class="tabs-closebutton"
                            oncommand="gCBClipboardViewer.togglePanel();" />
           </toolbar>
         </toolbox>
         <iframe id={this.id + "-iframe"} src="" flex="1" />
       </vbox>);

this.tooltipText = "\n\
Left-click: open in new window\n\n\
Middle-click: open in bottom panel\n\n\
Shift+click: open in sidebar\n\n\
Ctrl+click: open in new tab\n\
(for Firefox prior to version 4 only)\n\n";

]]></initcode>
  <code><![CDATA[var ww = Components.classes["@mozilla.org/embedcomp/window-watcher;1"]
                   .getService(Components.interfaces.nsIWindowWatcher);
                   
var em = ww.getWindowEnumerator();

var winName = "clipview";

var index = 1;
while (em.hasMoreElements()) {
  let win = em.getNext();
  if(win.name == winName) {
    win.focus();
    return;
  }
  index++
}

openDialog(this.xurl, winName, "chrome, dialog=no, centerscreen, minimizable, resizable");

]]></code>
  <accelkey><![CDATA[]]></accelkey>
  <help>&lt;?xml version="1.0"?&gt;
&lt;!--
  Version: MPL 1.1/GPL 2.0/LGPL 2.1

  The contents of this file are subject to the Mozilla Public License Version
  1.1 (the "License"); you may not use this file except in compliance with
  the License. You may obtain a copy of the License at
  http://www.mozilla.org/MPL/

  Software distributed under the License is distributed on an "AS IS" basis,
  WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
  for the specific language governing rights and limitations under the
  License.

  The Original Code is Clipboard Viewer

  The Initial Developer of the Original Code is LouCypher.
  Portions created by the Initial Developer are Copyright (C) 2011
  the Initial Developer. All Rights Reserved.

  Contributor(s):
  - LouCypher &lt;loucypher@mozillaca.com&gt;

  Alternatively, the contents of this file may be used under the terms of
  either the GNU General Public License Version 2 or later (the "GPL"), or
  the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
  in which case the provisions of the GPL or the LGPL are applicable instead
  of those above. If you wish to allow use of your version of this file only
  under the terms of either the GPL or the LGPL, and not to allow others to
  use your version of this file under the terms of the MPL, indicate your
  decision by deleting the provisions above and replace them with the notice
  and other provisions required by the GPL or the LGPL. If you do not delete
  the provisions above, a recipient may use your version of this file under
  the terms of any one of the MPL, the GPL or the LGPL.
--&gt;

&lt;?xml-stylesheet type="text/css" href="chrome://global/skin/"?&gt;
&lt;?xml-stylesheet type="text/css" href="clipboard-viewer.css"?&gt;

&lt;dialog xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
        xmlns:html="http://www.w3.org/1999/xhtml"
        id="clipboard-viewer"
        width="800"
        height="600"
        title="Clipboard Viewer"
        buttons="extra1, extra2, cancel"
        buttonlabelextra1="Edit"
        buttonlabelextra2="Clear"
        buttonlabelcancel="Close"
        buttonaccesskeyextra1="E"
        buttonaccesskeyextra2="r"
        buttonaccesskeycancel="C"
        ondialogextra1="toggleEdit();"
        ondialogextra2="clearClipboard();"
        ondialogcancel="closeDialog();"
        onfocus="loadFromClipboard();"&gt;

  &lt;html:head&gt;
    &lt;html:link rel="shortcut icon"
               href="chrome://chromedir/content/clipboard-viewer.png" /&gt;
  &lt;/html:head&gt;

  &lt;keyset&gt;&lt;key keycode="VK_F5" oncommand="loadFromClipboard();" /&gt;&lt;/keyset&gt;

  &lt;popupset&gt;
    &lt;menupopup id="contextmenu"
               onpopupshowing="popupShowing(event);"
               onpopuphiding="loadFromClipboard();"
               oncommand="var cmd = event.originalTarget.getAttribute('cmd');
 if (cmd) document.popupNode.parentNode.doCommand(cmd);"&gt;
      &lt;menuitem id="edit-copy" label="Copy" accesskey="c" cmd="cmd_copy" /&gt;
      &lt;!--menuitem id="edit-delete" label="Delete" accesskey="d" cmd="cmd_delete" /--&gt;
      &lt;menuseparator /&gt;
      &lt;menuitem id="edit-selectAll" label="Select All" accesskey="a" cmd="cmd_selectAll" /&gt;
    &lt;/menupopup&gt;
  &lt;/popupset&gt;

  &lt;textbox id="textbox" multiline="true" flex="1"
           context="contextmenu" onkeyup="copyToClipboard();" readonly="" /&gt;

  &lt;script type="application/x-javascript"&gt;&lt;![CDATA[
const Cc = Components.classes;
const Ci = Components.interfaces;

const gTextbox = document.getElementById("textbox");

const clipboardHelper = Cc["@mozilla.org/widget/clipboardhelper;1"].
                        getService(Ci.nsIClipboardHelper);

function getMainwin() {
  if (window.frameElement) {
    return window.frameElement.ownerDocument.defaultView;

  } else if (window.opener) {
    return window.opener;

  } else {
    return Cc['@mozilla.org/appshell/window-mediator;1'].
           getService().QueryInterface(Ci.nsIWindowMediator).
           getMostRecentWindow("navigator:browser")
  }
}

function readFromClipboard() {
//http://mxr.mozilla.org/mozilla2.0/source/browser/base/content/browser.js#2299
  var string;
  try {
      var clipboard = Cc["@mozilla.org/widget/clipboard;1"].
                      getService(Ci.nsIClipboard);
      var trans = Cc["@mozilla.org/widget/transferable;1"].
                  createInstance(Ci.nsITransferable);
      trans.addDataFlavor("text/unicode");
      if (clipboard.supportsSelectionClipboard()) {
        clipboard.getData(trans, clipboard.kSelectionClipboard);
      } else {
        clipboard.getData(trans, clipboard.kGlobalClipboard);
      }
      var data = {};
      var dataLen = {};
      trans.getTransferData("text/unicode", data, dataLen);
      if (data) {
        data = data.value.QueryInterface(Ci.nsISupportsString);
        string = data.data.substring(0, dataLen.value / 2);
      }
  } catch (ex) {
  }
  return string;
}

function loadFromClipboard() {
  var string = readFromClipboard();
  if (gTextbox.value != string) {
    if (!string) {
      gTextbox.value = "";
    } else {
      gTextbox.value = string;
    }
  }
}

function copyToClipboard() {
  clipboardHelper.copyString(gTextbox.value);
}

function clearClipboard() {
  clipboardHelper.copyString("");
  gTextbox.value = "";
}

function toggleEdit() {
  var button = document.documentElement.getButton("extra1");
  switch(gTextbox.readOnly) {
    case true:
      gTextbox.readOnly = false;
      button.label = "Lock";
      button.accessKey = "L";
      break;
    case false:
      gTextbox.readOnly = true;
      button.label = "Edit";
      button.accessKey = "E";
  }
  gTextbox.focus();
}

function closeDialog() {
  if (window.frameElement) {
    switch (window.frameElement.id) {
    case "sidebar":
      getMainwin().toggleSidebar();
      break;
    default:
      getMainwin().gCBClipboardViewer.togglePanel();
    }
  } else {
    window.close();
  }
}

function popupShowing(aEvent) {
  var children = aEvent.target.childNodes;
  for (var i = 0; i &lt; children.length; i++) {
    var command = children[i].getAttribute("cmd");
    if (command) {
      var controller = document.commandDispatcher
                               .getControllerForCommand(command);
      var enabled = controller.isCommandEnabled(command);
      if (enabled) {
        children[i].removeAttribute("disabled");
      } else {
        children[i].setAttribute("disabled", "true");
      }
    }
  }
}
  ]]&gt;&lt;/script&gt;

&lt;/dialog&gt;</help>
  <attributes/>
</custombutton>