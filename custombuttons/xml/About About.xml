<?xml version="1.0" encoding="UTF-8"?>
<custombutton xmlns:cb="http://xsms.nm.ru/custombuttons/"
              xmlns:html="http://www.w3.org/1999/xhtml">
  <html:head>
    <html:title><![CDATA[About About]]></html:title>
    <html:link rel="shortcut icon" href="http://www.mozilla.org/media/img/favicon.png"/>
    <html:style type="text/css"><![CDATA[
body { font-size: medium; margin: 0; }
body, code:before, help:before, initcode:before {
  font-family: "Verdana", sans-serif;
}
#wrapper { position: fixed; top: 1em; right: 1em; text-align: center; }
p { font-size: small; text-align: center; }
#button {
  background-color: rgb(85, 168, 2);
  background-image: linear-gradient(to bottom, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -moz-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -o-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -webkit-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  border: 1px solid rgb(58, 116, 4);
  border-radius: .5em;
  -moz-border-radius: .5em;
  -webkit-border-radius: .5em;
  padding: 0;
  margin-bottom: 1em;
  box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -moz-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -o-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -webkit-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
}
#button a {
  color: #000;
  text-shadow: -1pt -1px 0pt rgba(255, 255, 255, .5);
  padding: 1em;
  text-decoration: none;
}
:-moz-any-link:focus {
  color: white;
  outline-color: transparent;
  text-decoration: none;
}
#button a, code, code:before, initcode, initcode:before, help, help:before {
  display: block;
}
#credits { position: fixed; bottom: 1em; right: 1em; font-size: small; }
custombutton { background-color: rgb(171, 171, 171); margin: 1em; }
date, image, mode, accelkey { display: none; }
name { font-weight: bold; font-size: x-large; }
code:before, help:before, initcode:before {
  font-weight: bold;
  font-size: large;
  margin: 0 0 1em;
  padding: .5em;
}
code:before { content: "CODE"; }
help:before { content: "Help"; }
initcode:before { content: "Initialization Code"; }
code, initcode, help {
  background-color: rgb(255, 255, 255);
  border: 1px inset rgb(170, 170, 170);
  font: medium monospace;
  margin: 1em 1em 2em 0;
  padding: 1em;
  text-align: left;
  width: 840px;
  white-space: pre-wrap;
  word-wrap: break-word;
}
.clear { clear: both; }
]]></html:style>
  </html:head>
  <html:body>
    <html:div id="wrapper">
      <html:div id="button">
        <html:a href="custombutton://%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0D%0A%3Ccustombutton%20xmlns%3Acb%3D%22http%3A//xsms.nm.ru/custombuttons/%22%3E%0A%20%20%3Cname%3EAbout%20About%3C/name%3E%0A%20%20%3Cimage%3E%3C%21%5BCDATA%5Bhttp%3A//www.mozilla.org/media/img/favicon.png%5D%5D%3E%3C/image%3E%0A%20%20%3Cmode%3E0%3C/mode%3E%0A%20%20%3Cinitcode%3E%3C%21%5BCDATA%5B/*%20*****%20BEGIN%20LICENSE%20BLOCK%20*****%0A%20*%20Version%3A%20MPL%201.1/GPL%202.0/LGPL%202.1%0A%20*%0A%20*%20The%20contents%20of%20this%20file%20are%20subject%20to%20the%20Mozilla%20Public%20License%20Version%0A%20*%201.1%20%28the%20%22License%22%29%3B%20you%20may%20not%20use%20this%20file%20except%20in%20compliance%20with%0A%20*%20the%20License.%20You%20may%20obtain%20a%20copy%20of%20the%20License%20at%0A%20*%20http%3A//www.mozilla.org/MPL/1.1/%0A%20*%0A%20*%20Software%20distributed%20under%20the%20License%20is%20distributed%20on%20an%20%22AS%20IS%22%20basis%2C%0A%20*%20WITHOUT%20WARRANTY%20OF%20ANY%20KIND%2C%20either%20express%20or%20implied.%20See%20the%20License%0A%20*%20for%20the%20specific%20language%20governing%20rights%20and%20limitations%20under%20the%0A%20*%20License.%0A%20*%0A%20*%20The%20Original%20Code%20is%20about%3Aabout.%0A%20*%0A%20*%20The%20Initial%20Developer%20of%20the%20Original%20Code%20is%0A%20*%20Christopher%20A.%20Aillon%20%3Cchristopher@aillon.com%3E.%0A%20*%20Portions%20created%20by%20the%20Initial%20Developer%20are%20Copyright%20%28C%29%202003%0A%20*%20the%20Initial%20Developer.%20All%20Rights%20Reserved.%0A%20*%0A%20*%20Contributor%28s%29%3A%0A%20*%20%20%20Christopher%20A.%20Aillon%20%3Cchristopher@aillon.com%3E%0A%20*%20%20%20Steffen%20Wilberg%20%3Csteffen.wilberg@web.de%3E%0A%20*%20%20%20LouCypher%20%3Cloucypher@mozillaca.com%3E%20%28Custom%20Buttons%20+%20backward%20compat.%29%0A%20*%0A%20*%20Alternatively%2C%20the%20contents%20of%20this%20file%20may%20be%20used%20under%20the%20terms%20of%0A%20*%20either%20the%20GNU%20General%20Public%20License%20Version%202%20or%20later%20%28the%20%22GPL%22%29%2C%20or%0A%20*%20the%20GNU%20Lesser%20General%20Public%20License%20Version%202.1%20or%20later%20%28the%20%22LGPL%22%29%2C%0A%20*%20in%20which%20case%20the%20provisions%20of%20the%20GPL%20or%20the%20LGPL%20are%20applicable%20instead%0A%20*%20of%20those%20above.%20If%20you%20wish%20to%20allow%20use%20of%20your%20version%20of%20this%20file%20only%0A%20*%20under%20the%20terms%20of%20either%20the%20GPL%20or%20the%20LGPL%2C%20and%20not%20to%20allow%20others%20to%0A%20*%20use%20your%20version%20of%20this%20file%20under%20the%20terms%20of%20the%20MPL%2C%20indicate%20your%0A%20*%20decision%20by%20deleting%20the%20provisions%20above%20and%20replace%20them%20with%20the%20notice%0A%20*%20and%20other%20provisions%20required%20by%20the%20GPL%20or%20the%20LGPL.%20If%20you%20do%20not%20delete%0A%20*%20the%20provisions%20above%2C%20a%20recipient%20may%20use%20your%20version%20of%20this%20file%20under%0A%20*%20the%20terms%20of%20any%20one%20of%20the%20MPL%2C%20the%20GPL%20or%20the%20LGPL.%0A%20*%0A%20*%20*****%20END%20LICENSE%20BLOCK%20*****%20*/%0A%0Avar%20xml%20%3D%20%3Cmenupopup%20xmlns%3D%7Bxulns%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20oncontextmenu%3D%22event.preventDefault%28%29%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20oncommand%3D%22switchToTabHavingURI%28event.target.label%2C%20true%29%22/%3E%0Avar%20menu%20%3D%20this.appendChild%28cbu.makeXML%28xml%29%29%3B%0Athis.type%20%3D%20%22menu%22%3B%0A%0Avar%20protocols%20%3D%20%5B%5D%3B%0A%0Avar%20ios%20%3D%20Cc%5B%22@mozilla.org/network/io-service%3B1%22%5D.getService%28Ci.nsIIOService%29%3B%0Afor%20%28var%20cid%20in%20Cc%29%20%7B%0A%20%20let%20result%20%3D%20cid.match%28/@mozilla.org%5C/network%5C/protocol%5C/about%3B1%5C%3Fwhat%5C%3D%28.*%29%24/%29%3B%0A%20%20if%20%28result%29%20%7B%0A%20%20%20%20let%20aboutType%20%3D%20result%5B1%5D%3B%0A%20%20%20%20let%20contract%20%3D%20%22@mozilla.org/network/protocol/about%3B1%3Fwhat%3D%22%20+%20aboutType%3B%0A%20%20%20%20try%20%7B%0A%20%20%20%20%20%20let%20am%20%3D%20Cc%5Bcontract%5D.getService%28Ci.nsIAboutModule%29%3B%0A%20%20%20%20%20%20let%20uri%20%3D%20ios.newURI%28%22about%3A%22%20+%20aboutType%2C%20null%2C%20null%29%3B%0A%20%20%20%20%20%20let%20flags%20%3D%20am.getURIFlags%28uri%29%3B%0A%20%20%20%20%20%20if%20%28%21%28flags%20%26%20Ci.nsIAboutModule.HIDE_FROM_ABOUTABOUT%29%29%20%7B%0A%20%20%20%20%20%20%20%20protocols.push%28aboutType%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%20catch%20%28e%29%20%7B%0A%20%20%20%20%20%20//%20getService%20might%20have%20thrown%20if%20the%20component%20doesn%27t%20actually%0A%20%20%20%20%20%20//%20implement%20nsIAboutModule%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A%0Aprotocols.sort%28%29.forEach%28function%20createProtocolListing%28aProtocol%29%20%7B%0A%20%20menu.appendChild%28cbu.makeXML%28%3Cmenuitem%20xmlns%3D%7Bxulns%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20label%3D%7B%22about%3A%22%20+%20aProtocol%7D/%3E%29%29%3B%0A%7D%29%0A%0A%0A//%20Start%20backward%20compatibility%0Aif%20%28%22switchToTabHavingURI%22%20in%20window%29%20return%3B%0A%0Afunction%20switchToTabHavingURI%28aURI%2C%20aOpenNew%29%20%7B%0A%0A%20%20function%20switchIfURIInWindow%28aWindow%29%20%7B%0A%20%20%20%20var%20browsers%20%3D%20aWindow.gBrowser.browsers%3B%0A%20%20%20%20for%20%28let%20i%20%3D%200%3B%20i%20%3C%20browsers.length%3B%20i++%29%20%7B%0A%20%20%20%20%20%20let%20browser%20%3D%20browsers%5Bi%5D%3B%0A%20%20%20%20%20%20if%20%28browser.currentURI.equals%28aURI%29%29%20%7B%0A%20%20%20%20%20%20%20%20aWindow.focus%28%29%3B%0A%20%20%20%20%20%20%20%20aWindow.gBrowser.tabContainer.selectedIndex%20%3D%20i%3B%0A%20%20%20%20%20%20%20%20return%20true%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20return%20false%3B%0A%20%20%7D%0A%0A%20%20if%20%28%21%28aURI%20instanceof%20Ci.nsIURI%29%29%20%7B%0A%20%20%20%20aURI%20%3D%20makeURI%28aURI%2C%20null%2C%20null%29%3B%0A%20%20%7D%0A%20%20var%20isBrowserWindow%20%3D%20%21%21window.gBrowser%3B%0A%20%20if%20%28isBrowserWindow%20%26%26%20switchIfURIInWindow%28window%29%29%20%7B%0A%20%20%20%20return%20true%3B%0A%20%20%7D%0A%20%20var%20wm%20%3D%20Cc%5B%22@mozilla.org/appshell/window-mediator%3B1%22%5D.%0A%20%20%20%20%20%20%20%20%20%20%20getService%28Ci.nsIWindowMediator%29%3B%0A%20%20var%20winEnum%20%3D%20wm.getEnumerator%28%22navigator%3Abrowser%22%29%3B%0A%20%20while%20%28winEnum.hasMoreElements%28%29%29%20%7B%0A%20%20%20%20let%20browserWin%20%3D%20winEnum.getNext%28%29%3B%0A%20%20%20%20if%20%28browserWin.closed%20%7C%7C%20browserWin%20%3D%3D%20window%29%20%7B%0A%20%20%20%20%20%20continue%3B%0A%20%20%20%20%7D%0A%20%20%20%20if%20%28switchIfURIInWindow%28browserWin%29%29%20%7B%0A%20%20%20%20%20%20return%20true%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%20%20if%20%28aOpenNew%29%20%7B%0A%20%20%20%20if%20%28isBrowserWindow%20%26%26%20isTabEmpty%28gBrowser.selectedTab%29%29%20%7B%0A%20%20%20%20%20%20gBrowser.selectedBrowser.loadURI%28aURI.spec%29%3B%0A%20%20%20%20%20%20gBrowser.tabContainer.mTabstrip.ensureElementIsVisible%28gBrowser.selectedTab%29%3B%0A%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20openUILinkIn%28aURI.spec%2C%20%22tab%22%29%3B%0A%20%20%20%20%7D%0A%20%20%7D%0A%20%20return%20false%3B%0A%7D%0A%0Afunction%20isTabEmpty%28aTab%29%20%7B%0A%20%20var%20browser%20%3D%20aTab.linkedBrowser%3B%0A%20%20var%20uri%20%3D%20browser.currentURI.spec%3B%0A%20%20var%20body%20%3D%20browser.contentDocument.body%3B%0A%20%20return%20browser.sessionHistory.count%20%3C%202%20%26%26%0A%20%20%20%20%20%20%28uri%20%3D%3D%20%22about%3Ablank%22%29%20%26%26%0A%20%20%20%20%20%20%28%21body%20%7C%7C%20%21body.hasChildNodes%28%29%29%20%26%26%20%21aTab.hasAttribute%28%22busy%22%29%3B%0A%7D%0A%0Amenu.switchToTabHavingURI%20%3D%20switchToTabHavingURI.bind%28%29%3B%0A%5D%5D%3E%3C/initcode%3E%0A%20%20%3Ccode%3E%3C%21%5BCDATA%5B/*%0A%0Ahttp%3A//mxr.mozilla.org/mozilla-central/source/toolkit/content/aboutAbout.xhtml%0A%0Aor%20enter%20%27about%3Aabout%27%20in%20location%20bar%0A%0A*/%0A%5D%5D%3E%3C/code%3E%0A%20%20%3Caccelkey%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/accelkey%3E%0A%20%20%3Chelp%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/help%3E%0A%20%20%3Cattributes/%3E%0A%3C/custombutton%3E" rel="nofollow" title="Install About About">
        <![CDATA[Install this button]]>
        </html:a>
      </html:div>
      <html:a href="https://addons.mozilla.org/addon/custom-buttons/?src=external-custombuttons-xml">
        <![CDATA[What's this?]]>
      </html:a>
      <html:div id="credits">
        <html:a href="http://custombuttons.sourceforge.net/forum/viewtopic.php?t=78#p197">
          <![CDATA[Custom Buttons XML]]><html:br/><![CDATA[Exporter/Importer]]>
        </html:a>
      </html:div>
    </html:div>
  </html:body>
  <name>About About</name>
  <image><![CDATA[http://www.mozilla.org/media/img/favicon.png]]></image>
  <mode>0</mode>
  <initcode><![CDATA[/* ***** BEGIN LICENSE BLOCK *****
 * Version: MPL 1.1/GPL 2.0/LGPL 2.1
 *
 * The contents of this file are subject to the Mozilla Public License Version
 * 1.1 (the "License"); you may not use this file except in compliance with
 * the License. You may obtain a copy of the License at
 * http://www.mozilla.org/MPL/1.1/
 *
 * Software distributed under the License is distributed on an "AS IS" basis,
 * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
 * for the specific language governing rights and limitations under the
 * License.
 *
 * The Original Code is about:about.
 *
 * The Initial Developer of the Original Code is
 * Christopher A. Aillon <christopher@aillon.com>.
 * Portions created by the Initial Developer are Copyright (C) 2003
 * the Initial Developer. All Rights Reserved.
 *
 * Contributor(s):
 *   Christopher A. Aillon <christopher@aillon.com>
 *   Steffen Wilberg <steffen.wilberg@web.de>
 *   LouCypher <loucypher@mozillaca.com> (Custom Buttons + backward compat.)
 *
 * Alternatively, the contents of this file may be used under the terms of
 * either the GNU General Public License Version 2 or later (the "GPL"), or
 * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
 * in which case the provisions of the GPL or the LGPL are applicable instead
 * of those above. If you wish to allow use of your version of this file only
 * under the terms of either the GPL or the LGPL, and not to allow others to
 * use your version of this file under the terms of the MPL, indicate your
 * decision by deleting the provisions above and replace them with the notice
 * and other provisions required by the GPL or the LGPL. If you do not delete
 * the provisions above, a recipient may use your version of this file under
 * the terms of any one of the MPL, the GPL or the LGPL.
 *
 * ***** END LICENSE BLOCK ***** */

var xml = <menupopup xmlns={xulns}
             oncontextmenu="event.preventDefault()"
                 oncommand="switchToTabHavingURI(event.target.label, true)"/>
var menu = this.appendChild(cbu.makeXML(xml));
this.type = "menu";

var protocols = [];

var ios = Cc["@mozilla.org/network/io-service;1"].getService(Ci.nsIIOService);
for (var cid in Cc) {
  let result = cid.match(/@mozilla.org\/network\/protocol\/about;1\?what\=(.*)$/);
  if (result) {
    let aboutType = result[1];
    let contract = "@mozilla.org/network/protocol/about;1?what=" + aboutType;
    try {
      let am = Cc[contract].getService(Ci.nsIAboutModule);
      let uri = ios.newURI("about:" + aboutType, null, null);
      let flags = am.getURIFlags(uri);
      if (!(flags & Ci.nsIAboutModule.HIDE_FROM_ABOUTABOUT)) {
        protocols.push(aboutType);
      }
    } catch (e) {
      // getService might have thrown if the component doesn't actually
      // implement nsIAboutModule
    }
  }
}

protocols.sort().forEach(function createProtocolListing(aProtocol) {
  menu.appendChild(cbu.makeXML(<menuitem xmlns={xulns}
                                         label={"about:" + aProtocol}/>));
})


// Start backward compatibility
if ("switchToTabHavingURI" in window) return;

function switchToTabHavingURI(aURI, aOpenNew) {

  function switchIfURIInWindow(aWindow) {
    var browsers = aWindow.gBrowser.browsers;
    for (let i = 0; i < browsers.length; i++) {
      let browser = browsers[i];
      if (browser.currentURI.equals(aURI)) {
        aWindow.focus();
        aWindow.gBrowser.tabContainer.selectedIndex = i;
        return true;
      }
    }
    return false;
  }

  if (!(aURI instanceof Ci.nsIURI)) {
    aURI = makeURI(aURI, null, null);
  }
  var isBrowserWindow = !!window.gBrowser;
  if (isBrowserWindow && switchIfURIInWindow(window)) {
    return true;
  }
  var wm = Cc["@mozilla.org/appshell/window-mediator;1"].
           getService(Ci.nsIWindowMediator);
  var winEnum = wm.getEnumerator("navigator:browser");
  while (winEnum.hasMoreElements()) {
    let browserWin = winEnum.getNext();
    if (browserWin.closed || browserWin == window) {
      continue;
    }
    if (switchIfURIInWindow(browserWin)) {
      return true;
    }
  }
  if (aOpenNew) {
    if (isBrowserWindow && isTabEmpty(gBrowser.selectedTab)) {
      gBrowser.selectedBrowser.loadURI(aURI.spec);
      gBrowser.tabContainer.mTabstrip.ensureElementIsVisible(gBrowser.selectedTab);
    } else {
      openUILinkIn(aURI.spec, "tab");
    }
  }
  return false;
}

function isTabEmpty(aTab) {
  var browser = aTab.linkedBrowser;
  var uri = browser.currentURI.spec;
  var body = browser.contentDocument.body;
  return browser.sessionHistory.count < 2 &&
      (uri == "about:blank") &&
      (!body || !body.hasChildNodes()) && !aTab.hasAttribute("busy");
}

menu.switchToTabHavingURI = switchToTabHavingURI.bind();
]]></initcode>
  <code><![CDATA[/*

http://mxr.mozilla.org/mozilla-central/source/toolkit/content/aboutAbout.xhtml

or enter 'about:about' in location bar

*/
]]></code>
  <accelkey><![CDATA[]]></accelkey>
  <help><![CDATA[]]></help>
  <attributes/>
</custombutton>