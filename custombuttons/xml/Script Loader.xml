<?xml version="1.0" encoding="UTF-8"?>
<custombutton xmlns:cb="http://xsms.nm.ru/custombuttons/"
              xmlns:html="http://www.w3.org/1999/xhtml">
  <html:head>
    <html:title><![CDATA[Script Loader]]></html:title>
    <html:link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAALZSURBVBgZBcFLiFVlAADg7zzuPLzjzDjOMINMitIie5gF+UAkIZSgRQuXLZIWrY021dYIggJdJURElJsoqlWRYA9GshGFCNQeOjoTk6bjeOd5zzn/f07flzRNA459ObcHJ3cM9+1fq2prVa2qa+uh7mAZ9xCxiAV8iu9zgDqEvU9ODOx//dkxALBa1kNrZT202I2TZcVyEd28t+Lb66uHcTwHqEMYH+xJwNyDqJUk8oQsp7eV2tqbytJUK+OpyX5bhtojH07Pv58CxKoabOeEmuUy0al4UNDp0umysM5/KxG8eWbW/u1tj4+2xnKAWFUjG3tSqwWr3ShNEzmyjDQjk8gSaiRxyYUbiy7PduZzgFiW40P9mc56sFY00rSRpaQxkaVkGlmGJnNnqXDq7N9LOJYDhLLcNj7Y0uk2AjRkMZE2iGQaeZOqG2IrCmXY/s1rB+6nALEstk0M9VotG0lKliRSpEjw+YUjPjq3RxkKoSjEsoiQwvMnvusXQ09vK1VGUg1qjVrUqDWKUJoc3emVj3dbWeuEUJZLkEMoyrF2u0+aUEPD19OHNXVQ1kEZgy2bHrZzYq/l7qr766/m3VC0ub+SQyyLDXm7R56SpYlYJ0JdOvzYy2JTi3VUa8x35jwxecBKue7S7E+dXW+nI/nB42dGcWLPI1vdXmrcvBO1++iGUmxqtxb+UtVBqCtVrCwVy3Y/dNBKtZb+OjO1kMeyfA4vXLo6Y3E9t1I0qtjo6goxGB/cKtRRbGr/dmaNDEy4PHfe+etTd8vgSB6r6ukXD+3qf+ulfQDg6OnCJ7+8p6xL3VDaMfqofTuOuHhryrk/fl4tokPz7zRX8lhVM7fvdXx29qrhgX7Dg32G271OHv3dxg09entSvXnqmXcHJGm/6Ru/ad89dmrm9AdXIK9D+GLq4rXJqYvXtmEzNmMTNmGor6fV6utr6YxWfvjzR0P/vDGTh7GvAP4H2uh1wse2x/0AAAAASUVORK5CYII="/>
    <html:style type="text/css"><![CDATA[body { font-size: medium; margin: 0; }
body, code:before, help:before, initcode:before {
  font-family: "Verdana", sans-serif;
}
#wrapper { position: fixed; top: 1em; right: 1em; text-align: center; }
p { font-size: small; text-align: center; }
#button {
  background-color: rgb(85, 168, 2);
  background-image: linear-gradient(to bottom, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -moz-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -o-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  background-image: -webkit-linear-gradient(top, rgb(147, 200, 94), rgb(85, 168, 2));
  border: 1px solid rgb(58, 116, 4);
  border-radius: .5em;
  -moz-border-radius: .5em;
  -webkit-border-radius: .5em;
  padding: 0;
  margin-bottom: 1em;
  box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -moz-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -o-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
  -webkit-box-shadow: 1px 2px 3px rgba(0, 0, 0, .25);
}
#button a {
  color: #000;
  text-shadow: -1pt -1px 0pt rgba(255, 255, 255, .5);
  padding: 1em;
  text-decoration: none;
}
#button a, code, code:before, initcode, initcode:before, help, help:before {
  display: block;
}
#credits { position: fixed; bottom: 1em; right: 1em; font-size: small; }
custombutton { background-color: rgb(171, 171, 171); margin: 1em; }
date, image, mode, accelkey { display: none; }
name { font-weight: bold; font-size: x-large; }
code:before, help:before, initcode:before {
  font-weight: bold;
  font-size: large;
  margin: 0 0 1em;
  padding: .5em;
}
code:before { content: "CODE"; }
help:before { content: "Help"; }
initcode:before { content: "Initialization Code"; }
code, initcode, help {
  background-color: rgb(255, 255, 255);
  border: 1px inset rgb(170, 170, 170);
  font: medium monospace;
  margin: 1em 1em 2em 0;
  padding: 1em;
  text-align: left;
  width: 840px;
  white-space: pre-wrap;
  word-wrap: break-word;
}
.clear { clear: both; }
]]></html:style>
  </html:head>
  <html:body>
    <html:div id="wrapper">
      <html:div id="button">
        <html:a href="custombutton://%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%3F%3E%0D%0A%3Ccustombutton%20xmlns%3Acb%3D%22http%3A//xsms.nm.ru/custombuttons/%22%3E%0A%20%20%3Cname%3EScript%20Loader%3C/name%3E%0A%20%20%3Cimage%3E%3C%21%5BCDATA%5Bdata%3Aimage/png%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAALZSURBVBgZBcFLiFVlAADg7zzuPLzjzDjOMINMitIie5gF+UAkIZSgRQuXLZIWrY021dYIggJdJURElJsoqlWRYA9GshGFCNQeOjoTk6bjeOd5zzn/f07flzRNA459ObcHJ3cM9+1fq2prVa2qa+uh7mAZ9xCxiAV8iu9zgDqEvU9ODOx//dkxALBa1kNrZT202I2TZcVyEd28t+Lb66uHcTwHqEMYH+xJwNyDqJUk8oQsp7eV2tqbytJUK+OpyX5bhtojH07Pv58CxKoabOeEmuUy0al4UNDp0umysM5/KxG8eWbW/u1tj4+2xnKAWFUjG3tSqwWr3ShNEzmyjDQjk8gSaiRxyYUbiy7PduZzgFiW40P9mc56sFY00rSRpaQxkaVkGlmGJnNnqXDq7N9LOJYDhLLcNj7Y0uk2AjRkMZE2iGQaeZOqG2IrCmXY/s1rB+6nALEstk0M9VotG0lKliRSpEjw+YUjPjq3RxkKoSjEsoiQwvMnvusXQ09vK1VGUg1qjVrUqDWKUJoc3emVj3dbWeuEUJZLkEMoyrF2u0+aUEPD19OHNXVQ1kEZgy2bHrZzYq/l7qr766/m3VC0ub+SQyyLDXm7R56SpYlYJ0JdOvzYy2JTi3VUa8x35jwxecBKue7S7E+dXW+nI/nB42dGcWLPI1vdXmrcvBO1++iGUmxqtxb+UtVBqCtVrCwVy3Y/dNBKtZb+OjO1kMeyfA4vXLo6Y3E9t1I0qtjo6goxGB/cKtRRbGr/dmaNDEy4PHfe+etTd8vgSB6r6ukXD+3qf+ulfQDg6OnCJ7+8p6xL3VDaMfqofTuOuHhryrk/fl4tokPz7zRX8lhVM7fvdXx29qrhgX7Dg32G271OHv3dxg09entSvXnqmXcHJGm/6Ru/ad89dmrm9AdXIK9D+GLq4rXJqYvXtmEzNmMTNmGor6fV6utr6YxWfvjzR0P/vDGTh7GvAP4H2uh1wse2x/0AAAAASUVORK5CYII%3D%5D%5D%3E%3C/image%3E%0A%20%20%3Cmode%3E0%3C/mode%3E%0A%20%20%3Cinitcode%3E%3C%21%5BCDATA%5Bvar%20Cc%20%3D%20Components.classes%3B%0Avar%20Ci%20%3D%20Components.interfaces%3B%0A%0Avar%20prefString%20%3D%20%22custombuttons.jsRunner.lastScript%22%3B%0A%0Athis.getPref%20%3D%20function%28%29%20%7B%0A%20%20var%20pref%20%3D%20%22%22%3B%0A%20%20try%20%7B%0A%20%20%20%20pref%20%3D%20gPrefService.getCharPref%28prefString%29%3B%0A%20%20%7D%20catch%28ex%29%20%7B%0A%20%20%7D%0A%20%20return%20pref%3B%0A%7D%0A%0Athis.getFile%20%3D%20function%28%29%20%7B%0A%20%20const%20nsIFilePicker%20%3D%20Ci.nsIFilePicker%3B%0A%20%20var%20fp%20%3D%20Cc%5B%27@mozilla.org/filepicker%3B1%27%5D.%0A%20%20%20%20%20%20%20%20%20%20%20createInstance%28nsIFilePicker%29%3B%0A%20%20fp.init%28window%2C%20gNavigatorBundle.getString%28%22openFile%22%29%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20nsIFilePicker.modeOpen%29%3B%0A%20%20fp.appendFilter%28%22JavaScript%22%2C%20%22*.js%22%29%3B%0A%20%20fp.appendFilters%28nsIFilePicker.filterAll%29%3B%0A%20%20if%20%28fp.show%28%29%20%3D%3D%20nsIFilePicker.returnCancel%29%20return%3B%0A%20%20gPrefService.setCharPref%28prefString%2C%20fp.fileURL.spec%29%3B%0A%20%20return%20fp.fileURL.spec%3B%0A%7D%0A%0Athis.scriptLoader%20%3D%20function%28aFile%29%20%7B%0A%20%20var%20JSSubScriptLoader%20%3D%20Cc%5B%22@mozilla.org/moz/jssubscript-loader%3B1%22%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20.getService%28Ci.mozIJSSubScriptLoader%29%0A%20%20try%20%7B%0A%20%20%20%20JSSubScriptLoader.loadSubScript%28aFile%29%3B%0A%20%20%7D%20catch%28ex%29%20%7B%0A%20%20%20%20Components.utils.reportError%28ex%29%3B%0A%20%20%20%20Application.console.open%28%29%3B%0A%20%20%7D%0A%7D%0A%0Athis.click%20%3D%20function%28aEvent%29%20%7B%0A%20%20if%20%28aEvent.button%20%3D%3D%201%29%20%7B%0A%20%20%20%20var%20file%20%3D%20this.getPref%28%29%20%7C%7C%20this.getFile%28%29%3B%0A%20%20%20%20if%20%28%21file%29%20return%3B%0A%20%20%20%20this.scriptLoader%28file%29%3B%0A%20%20%7D%0A%7D%0A%0Athis.setAttribute%28%22onclick%22%2C%20%22this.click%28event%29%3B%22%29%3B%0A%0Avar%20tooltipId%20%3D%20%22scriptLoaderTooltip%22%3B%0Avar%20tooltipLabels%20%3D%20%5Bthis.label%2C%20%22%22%5D%3B%0A%0Athis.updateTooltip%20%3D%20function%28%29%20%7B%0A%20%20var%20tooltip%20%3D%20document.getElementById%28tooltipId%20+%20%222%22%29%3B%0A%20%20var%20pref%20%3D%20this.getPref%28%29%3B%0A%20%20tooltip.setAttribute%28%22value%22%2C%20pref%29%3B%0A%7D%0A%0Avar%20tooltip%20%3D%20this.appendChild%28document.createElement%28%22tooltip%22%29%29%3B%0Atooltip.id%20%3D%20tooltipId%3B%0Atooltip.setAttribute%28%22onpopupshowing%22%2C%20%22parentNode.updateTooltip%28%29%22%29%3B%0A%0Avar%20box%20%3D%20tooltip.appendChild%28document.createElement%28%22vbox%22%29%29%3B%0Afor%28var%20i%20%3D%200%3B%20i%20%3C%20tooltipLabels.length%3B%20i++%29%20%7B%0A%20%20var%20ttLabel%20%3D%20box.appendChild%28document.createElement%28%22label%22%29%29%3B%0A%20%20ttLabel.id%20%3D%20tooltipId%20+%20%28i%20+%201%29%3B%0A%20%20ttLabel.setAttribute%28%22value%22%2C%20tooltipLabels%5Bi%5D%29%3B%0A%7D%0A%0Athis.setAttribute%28%22tooltip%22%2C%20tooltipId%29%3B%0Athis.removeAttribute%28%22tooltiptext%22%29%3B%0A%0Athis.loadScript%20%3D%20function%28%29%20%7B%0A%20%20var%20file%20%3D%20this.getFile%28%29%3B%0A%20%20if%28%21file%29%20return%3B%0A%20%20this.scriptLoader%28file%29%3B%0A%7D%0A%0A%5D%5D%3E%3C/initcode%3E%0A%20%20%3Ccode%3E%3C%21%5BCDATA%5B/*%20-------------------------------------------------------------%0A%20%20%20%20%20Script%20Loader%0A%20%20%20%20%20by%20LouCypher%20%28aka%20Zoolcar9%29%0A%0A%20%20%20%20%20Load%20a%20script%20and%20execute%20it%0A%20%20%20-------------------------------------------------------------%20*/%0A%0Athis.loadScript%28%29%3B%0A%0A%5D%5D%3E%3C/code%3E%0A%20%20%3Caccelkey%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/accelkey%3E%0A%20%20%3Chelp%3E%3C%21%5BCDATA%5B%5D%5D%3E%3C/help%3E%0A%20%20%3Cattributes/%3E%0A%3C/custombutton%3E" rel="nofollow" title="Install Script Loader">
        <![CDATA[Install this button]]>
        </html:a>
      </html:div>
      <html:a href="https://addons.mozilla.org/addon/custom-buttons/?src=custom-buttons-xml">
        <![CDATA[What's this?]]>
      </html:a>
      <html:div id="credits">
        <html:a href="http://custombuttons.sourceforge.net/forum/viewtopic.php?t=78#p197">
          <![CDATA[Custom Buttons XML]]><html:br/><![CDATA[Exporter/Importer]]>
        </html:a>
      </html:div>
    </html:div>
  </html:body>
  <date id="date" value="20120329"/>
  <name>Script Loader</name>
  <image><![CDATA[data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAALZSURBVBgZBcFLiFVlAADg7zzuPLzjzDjOMINMitIie5gF+UAkIZSgRQuXLZIWrY021dYIggJdJURElJsoqlWRYA9GshGFCNQeOjoTk6bjeOd5zzn/f07flzRNA459ObcHJ3cM9+1fq2prVa2qa+uh7mAZ9xCxiAV8iu9zgDqEvU9ODOx//dkxALBa1kNrZT202I2TZcVyEd28t+Lb66uHcTwHqEMYH+xJwNyDqJUk8oQsp7eV2tqbytJUK+OpyX5bhtojH07Pv58CxKoabOeEmuUy0al4UNDp0umysM5/KxG8eWbW/u1tj4+2xnKAWFUjG3tSqwWr3ShNEzmyjDQjk8gSaiRxyYUbiy7PduZzgFiW40P9mc56sFY00rSRpaQxkaVkGlmGJnNnqXDq7N9LOJYDhLLcNj7Y0uk2AjRkMZE2iGQaeZOqG2IrCmXY/s1rB+6nALEstk0M9VotG0lKliRSpEjw+YUjPjq3RxkKoSjEsoiQwvMnvusXQ09vK1VGUg1qjVrUqDWKUJoc3emVj3dbWeuEUJZLkEMoyrF2u0+aUEPD19OHNXVQ1kEZgy2bHrZzYq/l7qr766/m3VC0ub+SQyyLDXm7R56SpYlYJ0JdOvzYy2JTi3VUa8x35jwxecBKue7S7E+dXW+nI/nB42dGcWLPI1vdXmrcvBO1++iGUmxqtxb+UtVBqCtVrCwVy3Y/dNBKtZb+OjO1kMeyfA4vXLo6Y3E9t1I0qtjo6goxGB/cKtRRbGr/dmaNDEy4PHfe+etTd8vgSB6r6ukXD+3qf+ulfQDg6OnCJ7+8p6xL3VDaMfqofTuOuHhryrk/fl4tokPz7zRX8lhVM7fvdXx29qrhgX7Dg32G271OHv3dxg09entSvXnqmXcHJGm/6Ru/ad89dmrm9AdXIK9D+GLq4rXJqYvXtmEzNmMTNmGor6fV6utr6YxWfvjzR0P/vDGTh7GvAP4H2uh1wse2x/0AAAAASUVORK5CYII=]]></image>
  <mode>0</mode>
  <initcode><![CDATA[var Cc = Components.classes;
var Ci = Components.interfaces;

var prefString = "custombuttons.jsRunner.lastScript";

this.getPref = function() {
  var pref = "";
  try {
    pref = gPrefService.getCharPref(prefString);
  } catch(ex) {
  }
  return pref;
}

this.getFile = function() {
  const nsIFilePicker = Ci.nsIFilePicker;
  var fp = Cc['@mozilla.org/filepicker;1'].
           createInstance(nsIFilePicker);
  fp.init(window, gNavigatorBundle.getString("openFile"),
                   nsIFilePicker.modeOpen);
  fp.appendFilter("JavaScript", "*.js");
  fp.appendFilters(nsIFilePicker.filterAll);
  if (fp.show() == nsIFilePicker.returnCancel) return;
  gPrefService.setCharPref(prefString, fp.fileURL.spec);
  return fp.fileURL.spec;
}

this.scriptLoader = function(aFile) {
  var JSSubScriptLoader = Cc["@mozilla.org/moz/jssubscript-loader;1"]
                            .getService(Ci.mozIJSSubScriptLoader)
  try {
    JSSubScriptLoader.loadSubScript(aFile);
  } catch(ex) {
    Components.utils.reportError(ex);
    Application.console.open();
  }
}

this.click = function(aEvent) {
  if (aEvent.button == 1) {
    var file = this.getPref() || this.getFile();
    if (!file) return;
    this.scriptLoader(file);
  }
}

this.setAttribute("onclick", "this.click(event);");

var tooltipId = "scriptLoaderTooltip";
var tooltipLabels = [this.label, ""];

this.updateTooltip = function() {
  var tooltip = document.getElementById(tooltipId + "2");
  var pref = this.getPref();
  tooltip.setAttribute("value", pref);
}

var tooltip = this.appendChild(document.createElement("tooltip"));
tooltip.id = tooltipId;
tooltip.setAttribute("onpopupshowing", "parentNode.updateTooltip()");

var box = tooltip.appendChild(document.createElement("vbox"));
for(var i = 0; i < tooltipLabels.length; i++) {
  var ttLabel = box.appendChild(document.createElement("label"));
  ttLabel.id = tooltipId + (i + 1);
  ttLabel.setAttribute("value", tooltipLabels[i]);
}

this.setAttribute("tooltip", tooltipId);
this.removeAttribute("tooltiptext");

this.loadScript = function() {
  var file = this.getFile();
  if(!file) return;
  this.scriptLoader(file);
}

]]></initcode>
  <code><![CDATA[/* -------------------------------------------------------------
     Script Loader
     by LouCypher (aka Zoolcar9)

     Load a script and execute it
   ------------------------------------------------------------- */

this.loadScript();

]]></code>
  <accelkey><![CDATA[]]></accelkey>
  <help><![CDATA[]]></help>
  <attributes/>
</custombutton>